<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¡°ê°ì¡°ê° ë¶„ìˆ˜ë‚˜ë¼</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts - Jua -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    
    <style>
        * {
            font-family: 'Jua', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #e0f2fe 0%, #fef3c7 100%);
            min-height: 100vh;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block !important;
        }
        
        /* ë©”ì¸ í˜ì´ì§€ë§Œ ìŠ¤í¬ë¡¤ ì—†ì´ */
        #home.section.active {
            height: 100vh;
            overflow: hidden;
        }
        
        .menu-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .menu-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .btn-primary {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        /* Canvas ìŠ¤íƒ€ì¼ */
        #fractionCanvas {
            border-radius: 1rem;
            background-color: white;
        }
        
        /* ì„¸ë¡œ ë¶„ìˆ˜ ìŠ¤íƒ€ì¼ */
        .fraction-vertical {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .fraction-numerator {
            font-weight: bold;
            line-height: 1.2;
            padding-bottom: 2px;
        }
        
        .fraction-line {
            width: 100%;
            border-bottom: 3px solid currentColor;
            margin: 4px 0;
            min-width: 50px;
            align-self: stretch;
        }
        
        /* ê²Œì„ ì¹´ë“œ ë‚´ ë¶„ìˆ˜ ì„  ë‘ê»˜ ì¡°ì • */
        #game1-area .fraction-line {
            border-bottom-width: 4px;
        }
        
        .fraction-denominator {
            font-weight: bold;
            line-height: 1.2;
            padding-top: 2px;
        }
        
        .mixed-fraction-container {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            justify-content: center;
        }
        
        .mixed-fraction-whole {
            font-weight: bold;
            align-self: center;
        }
        
        /* API Key ìƒíƒœ í‘œì‹œ ìŠ¤íƒ€ì¼ */
        #apiKeyStatus {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 999;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        #apiKeyStatus.valid {
            background-color: #10b981;
            color: white;
        }
        
        #apiKeyStatus.invalid {
            background-color: #ef4444;
            color: white;
        }
        
        #apiKeyStatus.checking {
            background-color: #f59e0b;
            color: white;
        }
        
        /* ì¹´ë“œ ë’¤ì§‘ê¸° ê²Œì„ ìŠ¤íƒ€ì¼ */
        .card-container {
            perspective: 1000px;
            aspect-ratio: 1;
            min-height: 120px;
        }
        
        .card {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        
        .card.flipped {
            transform: rotateY(180deg);
        }
        
        .card.disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .card-front,
        .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .card-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: rotateY(180deg);
        }
        
        .card-back {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            font-size: 3rem;
        }
        
        .card-back::before {
            content: '?';
            color: white;
            font-weight: bold;
        }
        
        .card.matched .card-front {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
        }
        
        @keyframes correct {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes incorrect {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .card.correct-animation {
            animation: correct 0.5s;
        }
        
        .card.incorrect-animation {
            animation: incorrect 0.5s;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
        }
    </style>
</head>
<body>
    <!-- API Key ìƒíƒœ í‘œì‹œ (ìµœìƒë‹¨) -->
    <div id="apiKeyStatus" class="checking">
        ğŸ” API Key í™•ì¸ ì¤‘...
    </div>
    
    <!-- [A] ë©”ì¸ í™”ë©´ (í™ˆ) -->
    <section id="home" class="section active h-screen flex items-center justify-center overflow-hidden">
        <div class="w-full h-full flex flex-col items-center justify-center px-4 py-8">
            <!-- ì œëª© ì˜ì—­ -->
            <div class="text-center mb-8 md:mb-12 flex-shrink-0">
                <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold text-blue-600 mb-2 md:mb-4 drop-shadow-lg">
                    ì¡°ê°ì¡°ê° ë¶„ìˆ˜ë‚˜ë¼
                </h1>
                <p class="text-lg md:text-2xl lg:text-3xl text-gray-700 mt-2 md:mt-4">
                    ì¬ë¯¸ìˆê²Œ ë°°ìš°ëŠ” ë¶„ìˆ˜ íƒêµ¬
                </p>
            </div>
            
            <!-- ë©”ë‰´ ê·¸ë¦¬ë“œ (í™”ë©´ ê³µê°„ì„ ê½‰ ì±„ìš°ë„ë¡) -->
            <div class="grid grid-cols-2 md:grid-cols-2 gap-4 md:gap-6 w-full max-w-4xl mx-auto flex-1 items-center justify-center">
                <!-- ë©”ë‰´ ì¹´ë“œ 1: ë¶„ìˆ˜ ì›ë¦¬ íŒŒí—¤ì¹˜ê¸° -->
                <button 
                    onclick="showSection('section1')" 
                    class="menu-card bg-gradient-to-br from-pink-300 to-pink-400 rounded-xl p-4 md:p-8 h-full flex flex-col items-center justify-center text-center shadow-lg hover:shadow-xl"
                >
                    <div class="text-4xl md:text-5xl mb-2 md:mb-4">ğŸ§</div>
                    <h2 class="text-xl md:text-3xl font-bold text-white mb-1 md:mb-2">ë¶„ìˆ˜ ì›ë¦¬ íŒŒí—¤ì¹˜ê¸°</h2>
                    <p class="text-sm md:text-lg text-white/90">ë¶„ìˆ˜ê°€ ë¬´ì—‡ì¸ì§€ ì•Œì•„ë´ìš”!</p>
                </button>
                
                <!-- ë©”ë‰´ ì¹´ë“œ 2: ë¶„ìˆ˜ ì§ê¿ ì°¾ê¸° -->
                <button 
                    onclick="showSection('section2')" 
                    class="menu-card bg-gradient-to-br from-purple-300 to-purple-400 rounded-xl p-4 md:p-8 h-full flex flex-col items-center justify-center text-center shadow-lg hover:shadow-xl"
                >
                    <div class="text-4xl md:text-5xl mb-2 md:mb-4">ğŸ§©</div>
                    <h2 class="text-xl md:text-3xl font-bold text-white mb-1 md:mb-2">ë¶„ìˆ˜ ì§ê¿ ì°¾ê¸°</h2>
                    <p class="text-sm md:text-lg text-white/90">ê°™ì€ ë¶„ìˆ˜ë¥¼ ì°¾ì•„ë´ìš”!</p>
                </button>
                
                <!-- ë©”ë‰´ ì¹´ë“œ 3: ë¶„ìˆ˜ ë¬´í•œì˜ ê³„ë‹¨ -->
                <button 
                    onclick="showSection('section3')" 
                    class="menu-card bg-gradient-to-br from-green-300 to-green-400 rounded-xl p-4 md:p-8 h-full flex flex-col items-center justify-center text-center shadow-lg hover:shadow-xl"
                >
                    <div class="text-4xl md:text-5xl mb-2 md:mb-4">ğŸƒ</div>
                    <h2 class="text-xl md:text-3xl font-bold text-white mb-1 md:mb-2">ë¶„ìˆ˜ ë¬´í•œì˜ ê³„ë‹¨</h2>
                    <p class="text-sm md:text-lg text-white/90">ë¶„ìˆ˜ ë§ì…ˆì„ í’€ë©° ê³„ë‹¨ì„ ì˜¬ë¼ê°€ìš”!</p>
                </button>
                
                <!-- ë©”ë‰´ ì¹´ë“œ 4: ì§€êµ¬ë¥¼ ì§€ì¼œë¼! ë¶„ìˆ˜ ëŒ€ì „ìŸ -->
                <button 
                    onclick="showSection('section4')" 
                    class="menu-card bg-gradient-to-br from-orange-300 to-orange-400 rounded-xl p-4 md:p-8 h-full flex flex-col items-center justify-center text-center shadow-lg hover:shadow-xl"
                >
                    <div class="text-4xl md:text-5xl mb-2 md:mb-4">âš”ï¸</div>
                    <h2 class="text-xl md:text-3xl font-bold text-white mb-1 md:mb-2">ì§€êµ¬ë¥¼ ì§€ì¼œë¼! ë¶„ìˆ˜ ëŒ€ì „ìŸ</h2>
                    <p class="text-sm md:text-lg text-white/90">ì§„ë¶„ìˆ˜ì™€ ê°€ë¶„ìˆ˜ë¥¼ ë§ì¶° ì§€êµ¬ë¥¼ ì§€ì¼œìš”!</p>
                </button>
            </div>
        </div>
    </section>

    <!-- [B] Section 1: ë¶„ìˆ˜ ì›ë¦¬ íŒŒí—¤ì¹˜ê¸° -->
    <section id="section1" class="section">
        <div class="container mx-auto px-4 py-8">
            <!-- í™ˆìœ¼ë¡œ ë²„íŠ¼ -->
            <button 
                onclick="showSection('home')" 
                class="btn-primary mb-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-md"
            >
                ğŸ  í™ˆìœ¼ë¡œ
            </button>
            
            <!-- ì œëª© -->
            <h2 class="text-5xl md:text-6xl font-bold text-center text-blue-600 mb-8">
                ğŸ§ ë¶„ìˆ˜ ì›ë¦¬ íŒŒí—¤ì¹˜ê¸°
            </h2>
            
            <!-- ì½˜í…ì¸  ì˜ì—­ -->
            <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 min-h-[600px]">
                <div id="simulation-area" class="w-full h-full">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- ì¢Œì¸¡: ì¡°ì‘ íŒ¨ë„ -->
                        <div class="space-y-6">
                            <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl p-6 shadow-md">
                                <h3 class="text-2xl font-bold text-gray-800 mb-4">ë¶„ì (Numerator)</h3>
                                <div class="flex items-center justify-center gap-4">
                                    <button 
                                        onclick="changeNumerator(-1)" 
                                        class="bg-red-400 hover:bg-red-500 text-white font-bold w-12 h-12 rounded-full shadow-md text-xl transition-all"
                                    >
                                        -
                                    </button>
                                    <span id="numerator-display" class="text-4xl font-bold text-gray-800 min-w-[60px] text-center">1</span>
                                    <button 
                                        onclick="changeNumerator(1)" 
                                        class="bg-green-400 hover:bg-green-500 text-white font-bold w-12 h-12 rounded-full shadow-md text-xl transition-all"
                                    >
                                        +
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 shadow-md">
                                <h3 class="text-2xl font-bold text-gray-800 mb-4">ë¶„ëª¨ (Denominator)</h3>
                                <div class="flex items-center justify-center gap-4">
                                    <button 
                                        onclick="changeDenominator(-1)" 
                                        class="bg-red-400 hover:bg-red-500 text-white font-bold w-12 h-12 rounded-full shadow-md text-xl transition-all"
                                    >
                                        -
                                    </button>
                                    <span id="denominator-display" class="text-4xl font-bold text-gray-800 min-w-[60px] text-center">4</span>
                                    <button 
                                        onclick="changeDenominator(1)" 
                                        class="bg-green-400 hover:bg-green-500 text-white font-bold w-12 h-12 rounded-full shadow-md text-xl transition-all"
                                    >
                                        +
                                    </button>
                                </div>
                            </div>
                            
                            <!-- í˜„ì¬ ë¶„ìˆ˜ í‘œì‹œ -->
                            <div class="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-xl p-6 shadow-md text-center">
                                <h3 class="text-xl font-bold text-gray-700 mb-3">í˜„ì¬ ë¶„ìˆ˜</h3>
                                <div id="fraction-display" class="text-5xl font-bold text-blue-600 mb-2 flex justify-center items-center">
                                    <!-- ì„¸ë¡œ ë¶„ìˆ˜ í˜•íƒœë¡œ í‘œì‹œë¨ -->
                                </div>
                                <div id="mixed-fraction-display" class="text-2xl text-gray-600 flex justify-center items-center">
                                    <!-- ëŒ€ë¶„ìˆ˜ í‘œì‹œ (ê°€ë¶„ìˆ˜ì¼ ê²½ìš°) -->
                                </div>
                            </div>
                            
                            <!-- AI ìŒ¤ ë²„íŠ¼ -->
                            <button 
                                onclick="askAITutor()" 
                                class="btn-primary w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-4 px-6 rounded-xl shadow-lg text-xl"
                            >
                                ğŸ¤·â€â™‚ï¸ ì˜ ëª¨ë¥´ê² ì–´ìš” (AIì„ ìƒë‹˜)
                            </button>
                        </div>
                        
                        <!-- ìš°ì¸¡: ì‹œê°í™” ì˜ì—­ -->
                        <div class="flex items-center justify-center">
                            <canvas id="fractionCanvas" width="400" height="400" class="max-w-full h-auto"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- AI íŠœí„° ëª¨ë‹¬ -->
            <div id="aiModal" class="modal">
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-3xl font-bold text-purple-600">ğŸ¤– ë¶„ìˆ˜ íƒí—˜ëŒ€ì¥ì˜ ì„¤ëª…</h3>
                        <button 
                            onclick="closeAIModal()" 
                            class="text-gray-500 hover:text-gray-700 text-3xl font-bold"
                        >
                            Ã—
                        </button>
                    </div>
                    <div id="aiResponse" class="text-xl text-gray-700 leading-relaxed">
                        <!-- AI ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    <div class="mt-6 text-center">
                        <button 
                            onclick="closeAIModal()" 
                            class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-xl shadow-md"
                        >
                            ë‹«ê¸°
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- [B] Section 2: ë¶„ìˆ˜ ì§ê¿ ì°¾ê¸° -->
    <section id="section2" class="section">
        <div class="container mx-auto px-4 py-8">
            <!-- í™ˆìœ¼ë¡œ ë²„íŠ¼ -->
            <button 
                onclick="showSection('home')" 
                class="btn-primary mb-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-md"
            >
                ğŸ  í™ˆìœ¼ë¡œ
            </button>
            
            <!-- ì œëª© -->
            <h2 class="text-5xl md:text-6xl font-bold text-center text-purple-600 mb-8">
                ğŸ§© ë¶„ìˆ˜ ì§ê¿ ì°¾ê¸°
            </h2>
            
            <!-- ì½˜í…ì¸  ì˜ì—­ -->
            <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 min-h-[500px]">
                <div id="game1-area" class="w-full h-full">
                    <!-- ê²Œì„ ì •ë³´ í‘œì‹œ -->
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex gap-6">
                            <div class="bg-blue-100 px-4 py-2 rounded-lg">
                                <span class="text-sm text-gray-600">ë‚¨ì€ ì‹œê°„</span>
                                <div id="game1-timer" class="text-2xl font-bold text-blue-600">--</div>
                            </div>
                            <div class="bg-red-100 px-4 py-2 rounded-lg">
                                <span class="text-sm text-gray-600">í‹€ë¦° íšŸìˆ˜</span>
                                <div id="game1-errors" class="text-2xl font-bold text-red-600">0</div>
                            </div>
                        </div>
                        <button 
                            id="game1-start-btn" 
                            onclick="startGame1()"
                            class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-3 px-6 rounded-xl shadow-md text-lg"
                        >
                            ê²Œì„ ì‹œì‘
                        </button>
                    </div>
                    
                    <!-- ì¹´ë“œ ê·¸ë¦¬ë“œ -->
                    <div id="game1-cards" class="grid grid-cols-3 md:grid-cols-4 gap-4 mb-6">
                        <!-- ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                    
                    <!-- ì„±ê³µ ë©”ì‹œì§€ -->
                    <div id="game1-success" class="hidden text-center">
                        <div class="text-5xl mb-4">ğŸ‰</div>
                        <h3 class="text-3xl font-bold text-green-600 mb-4">ì„±ê³µ!</h3>
                        <p id="game1-result" class="text-xl text-gray-700 mb-6"></p>
                        <button 
                            onclick="startGame1()"
                            class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-3 px-8 rounded-xl shadow-md text-lg"
                        >
                            ë‹¤ì‹œ í•˜ê¸°
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- [B] Section 3: ë¶„ìˆ˜ ë¬´í•œì˜ ê³„ë‹¨ -->
    <section id="section3" class="section">
        <div class="container mx-auto px-4 py-8">
            <!-- í™ˆìœ¼ë¡œ ë²„íŠ¼ -->
            <button 
                onclick="showSection('home')" 
                class="btn-primary mb-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-md"
            >
                ğŸ  í™ˆìœ¼ë¡œ
            </button>
            
            <!-- ì œëª© -->
            <h2 class="text-5xl md:text-6xl font-bold text-center text-green-600 mb-8">
                ğŸƒ ë¶„ìˆ˜ ë¬´í•œì˜ ê³„ë‹¨
            </h2>
            
            <!-- ì½˜í…ì¸  ì˜ì—­ -->
            <div class="bg-white rounded-2xl shadow-xl p-4 md:p-6 flex justify-center">
                <div id="game2-container" class="relative" style="max-width: 480px; width: 100%; height: 700px; max-height: 80vh; background-color: #fff; box-shadow: 0 0 20px rgba(0,0,0,0.2); overflow: hidden;">
                    <canvas id="game2-canvas" style="display: block; width: 100%; height: 100%;"></canvas>

                    <div class="ui-layer" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; justify-content: space-between;">
                        <div class="header" style="padding: 20px; text-align: center; font-family: 'Black Han Sans', sans-serif; text-shadow: 2px 2px 0 #fff;">
                            <div id="progress-text" style="font-size: 1.2rem; color: #555;">ëª©í‘œ: 100ê³„ë‹¨</div>
                            <div id="score-board" style="font-size: 3rem; color: #ff6b6b;">0 F</div>
                        </div>
                        
                        <div class="controls" style="padding: 20px; display: flex; justify-content: center; pointer-events: auto; margin-bottom: 30px;">
                            <button id="climb-btn" style="width: 200px; height: 80px; font-size: 2rem; font-family: 'Black Han Sans', sans-serif; background-color: #4CAF50; color: white; border: none; border-radius: 40px; box-shadow: 0 8px 0 #388E3C; cursor: pointer; transition: transform 0.1s;" onmousedown="this.style.transform='translateY(4px)'; this.style.boxShadow='0 4px 0 #388E3C';" onmouseup="this.style.transform=''; this.style.boxShadow='0 8px 0 #388E3C';" ontouchstart="this.style.transform='translateY(4px)'; this.style.boxShadow='0 4px 0 #388E3C';" ontouchend="this.style.transform=''; this.style.boxShadow='0 8px 0 #388E3C';">ì˜¤ë¥´ê¸°!</button>
                        </div>
                        
                        <div id="jump-msg" class="jump-effect" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 3rem; font-weight: bold; color: #ffca28; text-shadow: 2px 2px 0 #000; pointer-events: none; display: none;">SUPER JUMP!</div>
                    </div>

                    <div id="quiz-modal" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); display: none; flex-direction: column; justify-content: center; align-items: center; pointer-events: auto; z-index: 100;">
                        <div class="quiz-box" style="background-color: white; padding: 30px; border-radius: 20px; width: 80%; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.5);">
                            <h2 style="margin-top:0; color:#4CAF50;">ğŸ§© ë¶„ìˆ˜ í€´ì¦ˆ!</h2>
                            <div class="quiz-question" id="quiz-content" style="font-size: 2.5rem; margin-bottom: 20px; font-weight: bold; color: #333;"></div>
                            <div class="options-grid" id="quiz-options" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- [B] Section 4: ì§€êµ¬ë¥¼ ì§€ì¼œë¼! ë¶„ìˆ˜ ëŒ€ì „ìŸ -->
    <section id="section4" class="section">
        <div class="container mx-auto px-4 py-8">
            <!-- í™ˆìœ¼ë¡œ ë²„íŠ¼ -->
            <button 
                onclick="showSection('home')" 
                class="btn-primary mb-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-md"
            >
                ğŸ  í™ˆìœ¼ë¡œ
            </button>
            
            <!-- ì œëª© -->
            <h2 class="text-5xl md:text-6xl font-bold text-center text-orange-600 mb-8">
                âš”ï¸ ì§€êµ¬ë¥¼ ì§€ì¼œë¼! ë¶„ìˆ˜ ëŒ€ì „ìŸ
            </h2>
            
            <!-- ì½˜í…ì¸  ì˜ì—­ -->
            <div class="bg-white rounded-2xl shadow-xl p-4 md:p-6 flex justify-center">
                <div id="game3-container" class="relative" style="max-width: 600px; width: 100%; height: 100vh; max-height: 80vh; background: linear-gradient(to bottom, #020024 0%, #090979 35%, #00d4ff 100%); overflow: hidden; box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);">
                    <canvas id="game3-canvas" style="display: block; width: 100%; height: 100%;"></canvas>

                    <div class="ui-layer" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; z-index: 10;">
                        <div class="hud-top" style="padding: 20px; display: flex; justify-content: space-between; align-items: flex-start;">
                            <div class="left-group" style="display: flex; flex-direction: column; gap: 10px; align-items: flex-start;">
                                <div id="target-badge" class="target-badge badge-proper" style="background-color: #fff; color: #333; padding: 10px 20px; border-radius: 5px; font-family: 'Black Han Sans', sans-serif; font-size: 1.8rem; box-shadow: 3px 3px 0 rgba(0,0,0,0.3); border: 3px solid #333; transition: all 0.3s; text-align: center; min-width: 120px;">ì§„ë¶„ìˆ˜</div>
                                <div class="score-box" style="font-size: 1.2rem; color:#aaa;">STAGE <span id="stage-num">1</span></div>
                            </div>

                            <div class="info-group" style="display: flex; flex-direction: column; gap: 5px; align-items: flex-end;">
                                <div class="life-box" id="lives" style="font-size: 2rem; color: #ff4757;">â¤ï¸â¤ï¸â¤ï¸</div>
                                <div class="timer-box" id="timer-box" style="font-family: 'Black Han Sans', sans-serif; font-size: 2.5rem; color: #fff; background: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 10px; border: 2px solid #fff; margin-top: 10px;">
                                    â³ <span id="timer">60</span>
                                </div>
                            </div>
                        </div>
                        
                        <div id="stage-banner" style="position: absolute; top: 20%; left: 50%; transform: translateX(-50%); font-family: 'Black Han Sans', sans-serif; font-size: 4rem; color: rgba(255, 255, 255, 0.2); white-space: nowrap; pointer-events: none; text-shadow: 0 0 10px rgba(255,255,255,0.1);">STAGE 1</div>
                        <div class="controls-hint" style="position: absolute; bottom: 20px; width: 100%; text-align: center; font-size: 1rem; opacity: 0.7; text-shadow: 1px 1px 0 #000;">PC: ì¢Œìš° í™”ì‚´í‘œ / ìŠ¤í˜ì´ìŠ¤ë°”(ë°œì‚¬)<br>í„°ì¹˜: í™”ë©´ ì¢Œìš° í„°ì¹˜ / ì¤‘ì•™ í„°ì¹˜(ë°œì‚¬)</div>
                    </div>

                    <div id="screen-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; pointer-events: auto;">
                        <div class="overlay-content" id="overlay-text" style="display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; width: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- JavaScript -->
    <!-- showSection í•¨ìˆ˜ë¥¼ ë¨¼ì € ì •ì˜ (onclickì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´) -->
    <script>
        // ì„¹ì…˜ ì „í™˜ í•¨ìˆ˜ (ì „ì—­ìœ¼ë¡œ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥)
        function showSection(sectionId) {
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            const allSections = document.querySelectorAll('.section');
            allSections.forEach(section => {
                section.classList.remove('active');
            });
            
            // ì„ íƒí•œ ì„¹ì…˜ ë³´ì´ê¸°
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                
                // ê° ì„¹ì…˜ë³„ ì´ˆê¸°í™”ëŠ” ëª¨ë“ˆ ìŠ¤í¬ë¦½íŠ¸ì˜ ì˜¤ë²„ë¼ì´ë“œëœ showSectionì—ì„œ ì²˜ë¦¬
                // ì—¬ê¸°ì„œëŠ” ì„¹ì…˜ ì „í™˜ë§Œ ìˆ˜í–‰
            }
        }
        // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
        window.showSection = showSection;
    </script>
    
    <script type="module">
        // ========== ì „ì—­ ë³€ìˆ˜ ==========
        let numerator = 1;  // ë¶„ì
        let denominator = 4;  // ë¶„ëª¨
        let API_KEY_FINAL = null;  // API Key (ë‚˜ì¤‘ì— ì„¤ì •ë¨)
        
        // í™˜ê²½ë³€ìˆ˜ ê°€ì ¸ì˜¤ê¸° (config.jsì—ì„œ import)
        import { API_KEY } from './src/config.js';
        
        // ì¦‰ì‹œ API_KEY ì„¤ì • ì‹œë„
        API_KEY_FINAL = API_KEY;
        
        // ë””ë²„ê¹…: í™˜ê²½ë³€ìˆ˜ í™•ì¸
        console.log('=== index.html ìŠ¤í¬ë¦½íŠ¸ì—ì„œ í™˜ê²½ë³€ìˆ˜ í™•ì¸ ===');
        console.log('import.meta.env:', import.meta.env);
        console.log('import.meta.env.VITE_OPENAI_API_KEY:', import.meta.env.VITE_OPENAI_API_KEY);
        console.log('import.meta.env.MODE:', import.meta.env.MODE);
        console.log('import.meta.env.DEV:', import.meta.env.DEV);
        console.log('config.jsì—ì„œ ê°€ì ¸ì˜¨ API_KEY:', API_KEY);
        console.log('API_KEY íƒ€ì…:', typeof API_KEY);
        console.log('API_KEY ê°’:', API_KEY ? `"${API_KEY.substring(0, 10)}..." (ê¸¸ì´: ${API_KEY.length})` : 'undefined ë˜ëŠ” null');
        console.log('window.VITE_OPENAI_API_KEY:', window.VITE_OPENAI_API_KEY);
        
        // API_KEY ì„¤ì • (ì—¬ëŸ¬ ì†ŒìŠ¤ì—ì„œ ì‹œë„)
        if (!API_KEY_FINAL) {
            API_KEY_FINAL = window.VITE_OPENAI_API_KEY || import.meta.env.VITE_OPENAI_API_KEY;
        }
        console.log('ìµœì¢… API_KEY_FINAL:', API_KEY_FINAL ? `"${API_KEY_FINAL.substring(0, 10)}..." (ê¸¸ì´: ${API_KEY_FINAL.length})` : 'undefined ë˜ëŠ” ë¹ˆ ê°’');
        console.log('==========================================');
        
        // config.jsê°€ ë¡œë“œë  ë•Œê¹Œì§€ ì ì‹œ ëŒ€ê¸° í›„ API Key ê²€ì¦
        setTimeout(() => {
            // window ê°ì²´ì— ë‹¤ì‹œ í™•ì¸
            if (!API_KEY_FINAL) {
                API_KEY_FINAL = window.VITE_OPENAI_API_KEY || import.meta.env.VITE_OPENAI_API_KEY;
                console.log('setTimeout í›„ ì¬í™•ì¸ - API_KEY_FINAL:', API_KEY_FINAL ? `"${API_KEY_FINAL.substring(0, 10)}..."` : 'ì—†ìŒ');
            }
            checkAPIKey();
        }, 200);
        
        // ========== API Key ê²€ì¦ í•¨ìˆ˜ ==========
        async function checkAPIKey() {
            const statusDiv = document.getElementById('apiKeyStatus');
            
            // API_KEY_FINAL ì¬í™•ì¸ (ë™ì  ì—…ë°ì´íŠ¸)
            let currentAPIKey = API_KEY_FINAL || window.VITE_OPENAI_API_KEY || import.meta.env.VITE_OPENAI_API_KEY;
            
            console.log('checkAPIKey í˜¸ì¶œë¨ - currentAPIKey:', currentAPIKey ? 'ìˆìŒ (ê¸¸ì´: ' + currentAPIKey.length + ')' : 'ì—†ìŒ');
            
            if (!currentAPIKey || currentAPIKey === 'your_api_key_here' || String(currentAPIKey).trim() === '' || currentAPIKey === 'undefined') {
                statusDiv.className = 'invalid';
                statusDiv.textContent = 'âŒ API Key ë¯¸ì„¤ì •';
                statusDiv.title = '.env íŒŒì¼ì— VITE_OPENAI_API_KEY=sk-your-keyë¥¼ ì„¤ì •í•˜ê³  Vite ì„œë²„ë¥¼ ì¬ì‹œì‘í•˜ì„¸ìš”.';
                console.error('API Keyë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. .env íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.');
                return false;
            }
            
            // API Key í˜•ì‹ í™•ì¸ (sk-ë¡œ ì‹œì‘í•˜ëŠ”ì§€)
            if (!currentAPIKey.startsWith('sk-')) {
                statusDiv.className = 'invalid';
                statusDiv.textContent = 'âš ï¸ API Key í˜•ì‹ ì˜¤ë¥˜';
                statusDiv.title = 'API KeyëŠ” sk-ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤.';
                return false;
            }
            
            // ì‹¤ì œ API í˜¸ì¶œë¡œ ê²€ì¦
            statusDiv.className = 'checking';
            statusDiv.textContent = 'ğŸ” API Key ê²€ì¦ ì¤‘...';
            
            try {
                const response = await fetch('https://api.openai.com/v1/models', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${currentAPIKey}`
                    }
                });
                
                if (response.ok) {
                    statusDiv.className = 'valid';
                    statusDiv.textContent = 'âœ… API Key ì •ìƒ';
                    statusDiv.title = 'OpenAI APIê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.';
                    return true;
                } else if (response.status === 401) {
                    statusDiv.className = 'invalid';
                    statusDiv.textContent = 'âŒ API Key ì¸ì¦ ì‹¤íŒ¨';
                    statusDiv.title = 'API Keyê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                    return false;
                } else {
                    statusDiv.className = 'invalid';
                    statusDiv.textContent = 'âš ï¸ API ì—°ê²° ì˜¤ë¥˜';
                    statusDiv.title = `API ì—°ê²° ì˜¤ë¥˜: ${response.status}`;
                    return false;
                }
            } catch (error) {
                statusDiv.className = 'invalid';
                statusDiv.textContent = 'âš ï¸ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜';
                statusDiv.title = `ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`;
                return false;
            }
        }
        
        // ========== ì„¹ì…˜ë³„ ì´ˆê¸°í™” í•¨ìˆ˜ ==========
        function initSection(sectionId) {
            // Section 1ë¡œ ì´ë™ ì‹œ Canvas ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            if (sectionId === 'section1') {
                setTimeout(() => {
                    if (typeof drawFraction === 'function') drawFraction();
                }, 100);
            }
            // Section 2ë¡œ ì´ë™ ì‹œ ê²Œì„ ì´ˆê¸°í™”
            if (sectionId === 'section2') {
                // ê²Œì„ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì´ˆê¸° ìƒíƒœë¡œ
                if (typeof game1State !== 'undefined' && !game1State.gameStarted) {
                    const cardsContainer = document.getElementById('game1-cards');
                    const successDiv = document.getElementById('game1-success');
                    const startBtn = document.getElementById('game1-start-btn');
                    if (cardsContainer) cardsContainer.innerHTML = '';
                    if (successDiv) successDiv.classList.add('hidden');
                    if (startBtn) {
                        startBtn.disabled = false;
                        startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                }
            }
            // Section 3ë¡œ ì´ë™ ì‹œ ê²Œì„ ì´ˆê¸°í™”
            if (sectionId === 'section3') {
                setTimeout(() => {
                    if (typeof startGame2 === 'function') startGame2();
                }, 100);
            }
            // Section 4ë¡œ ì´ë™ ì‹œ ê²Œì„ ì´ˆê¸°í™”
            if (sectionId === 'section4') {
                setTimeout(() => {
                    if (typeof resizeGame3 === 'function') resizeGame3();
                    if (typeof showGame3Intro === 'function') showGame3Intro();
                }, 100);
            }
        }
        
        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
        window.initSection = initSection;
        
        // showSection í•¨ìˆ˜ ì˜¤ë²„ë¼ì´ë“œ (ì„¹ì…˜ë³„ ì´ˆê¸°í™” í¬í•¨)
        // ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ì˜ showSectionì„ í™•ì¥í•˜ì—¬ initSection í˜¸ì¶œ ì¶”ê°€
        if (typeof window.showSection === 'function') {
            const originalShowSection = window.showSection;
            window.showSection = function(sectionId) {
                originalShowSection(sectionId);
                // ì„¹ì…˜ë³„ ì´ˆê¸°í™” ì‹¤í–‰
                initSection(sectionId);
            };
        }
        
        // ========== ë¶„ì ì¡°ì ˆ í•¨ìˆ˜ ==========
        function changeNumerator(delta) {
            numerator += delta;
            if (numerator < 0) numerator = 0;
            updateDisplay();
            drawFraction();
        }
        
        // ========== ë¶„ëª¨ ì¡°ì ˆ í•¨ìˆ˜ ==========
        function changeDenominator(delta) {
            denominator += delta;
            if (denominator < 1) denominator = 1;
            if (denominator > 10) denominator = 10;
            updateDisplay();
            drawFraction();
        }
        
        // ========== ì„¸ë¡œ ë¶„ìˆ˜ ë Œë”ë§ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ==========
        /**
         * ë¶„ìˆ˜ë¥¼ ì„¸ë¡œ í˜•íƒœ(êµê³¼ì„œ ìŠ¤íƒ€ì¼)ë¡œ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
         * @param {number} num - ë¶„ì
         * @param {number} den - ë¶„ëª¨
         * @param {string} sizeClass - Tailwind CSS í¬ê¸° í´ë˜ìŠ¤ (ì˜ˆ: 'text-5xl', 'text-3xl')
         * @returns {string} HTML ë¬¸ìì—´
         */
        function renderFraction(num, den, sizeClass = 'text-5xl') {
            return `
                <div class="fraction-vertical ${sizeClass}">
                    <span class="fraction-numerator">${num}</span>
                    <div class="fraction-line"></div>
                    <span class="fraction-denominator">${den}</span>
                </div>
            `;
        }
        
        /**
         * ëŒ€ë¶„ìˆ˜ë¥¼ ì„¸ë¡œ í˜•íƒœë¡œ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
         * @param {number} whole - ìì—°ìˆ˜ ë¶€ë¶„
         * @param {number} num - ë¶„ì
         * @param {number} den - ë¶„ëª¨
         * @param {string} sizeClass - Tailwind CSS í¬ê¸° í´ë˜ìŠ¤
         * @returns {string} HTML ë¬¸ìì—´
         */
        function renderMixedFraction(whole, num, den, sizeClass = 'text-2xl') {
            return `
                <div class="mixed-fraction-container ${sizeClass}">
                    <span class="mixed-fraction-whole">${whole}</span>
                    ${renderFraction(num, den, sizeClass)}
                </div>
            `;
        }
        
        // ========== í™”ë©´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ==========
        function updateDisplay() {
            document.getElementById('numerator-display').textContent = numerator;
            document.getElementById('denominator-display').textContent = denominator;
            
            // ì„¸ë¡œ ë¶„ìˆ˜ í˜•íƒœë¡œ í‘œì‹œ
            const fractionDisplay = document.getElementById('fraction-display');
            fractionDisplay.innerHTML = renderFraction(numerator, denominator, 'text-5xl');
            
            // ëŒ€ë¶„ìˆ˜ í‘œì‹œ (ê°€ë¶„ìˆ˜ì¼ ê²½ìš°)
            const mixedFractionDisplay = document.getElementById('mixed-fraction-display');
            if (numerator >= denominator && denominator > 0) {
                const whole = Math.floor(numerator / denominator);
                const remainder = numerator % denominator;
                if (remainder === 0) {
                    // ì •ìˆ˜ì¸ ê²½ìš°
                    mixedFractionDisplay.innerHTML = `<span class="text-2xl font-bold text-gray-600">${whole}</span>`;
                } else {
                    // ëŒ€ë¶„ìˆ˜ì¸ ê²½ìš°
                    mixedFractionDisplay.innerHTML = renderMixedFraction(whole, remainder, denominator, 'text-2xl');
                }
            } else {
                mixedFractionDisplay.innerHTML = '';
            }
        }
        
        // ========== Canvasì— ë¶„ìˆ˜ ê·¸ë¦¬ê¸° í•¨ìˆ˜ ==========
        function drawFraction() {
            const canvas = document.getElementById('fractionCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            
            if (denominator === 0) return;
            
            const centerX = width / 2;
            const centerY = height / 2;
            
            // ê°€ë¶„ìˆ˜ ì²˜ë¦¬: ë¶„ìê°€ ë¶„ëª¨ë³´ë‹¤ í¬ë©´ ì—¬ëŸ¬ ê°œì˜ ì› ê·¸ë¦¬ê¸°
            const fullCircles = Math.floor(numerator / denominator);
            const remainder = numerator % denominator;
            const totalCircles = fullCircles + (remainder > 0 ? 1 : 0);
            
            // ë™ì  ë°˜ì§€ë¦„ ê³„ì‚°
            const defaultRadius = 80;  // ê¸°ë³¸ ë°˜ì§€ë¦„
            const defaultGap = 20;  // ì›ë“¤ ì‚¬ì´ì˜ ê¸°ë³¸ ê°„ê²©
            const padding = 20;  // ì–‘ìª½ ì—¬ë°±
            
            // í•„ìš”í•œ ì´ ë„ˆë¹„ ê³„ì‚°
            // ê° ì›ì˜ ì§€ë¦„: radius * 2
            // ì›ë“¤ ì‚¬ì´ì˜ ê°„ê²©: gap
            // ì´ ë„ˆë¹„ = (ì› ê°œìˆ˜ * ì§€ë¦„) + (ì› ê°œìˆ˜ - 1) * ê°„ê²© + ì–‘ìª½ ì—¬ë°±
            const requiredWidth = totalCircles * (defaultRadius * 2) + (totalCircles - 1) * defaultGap + padding * 2;
            
            // ë°˜ì§€ë¦„ê³¼ ê°„ê²©ì„ ë™ì ìœ¼ë¡œ ì¡°ì •
            let radius = defaultRadius;
            let gap = defaultGap;
            
            if (requiredWidth > width) {
                // ê³µê°„ì´ ë¶€ì¡±í•˜ë©´ ë¹„ìœ¨ì— ë§ì¶° ì¤„ì„
                const availableWidth = width - padding * 2;
                const scaleFactor = availableWidth / (requiredWidth - padding * 2);
                radius = defaultRadius * scaleFactor;
                gap = defaultGap * scaleFactor;
            }
            
            // ì›ì˜ ì¤‘ì‹¬ ê°„ê²© ê³„ì‚° (ì§€ë¦„ + ê°„ê²©)
            const circleSpacing = radius * 2 + gap;
            
            // ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•œ ì‹œì‘ X ì¢Œí‘œ ê³„ì‚°
            const totalWidth = totalCircles * (radius * 2) + (totalCircles - 1) * gap;
            const startX = centerX - totalWidth / 2 + radius;
            
            for (let circleIndex = 0; circleIndex < totalCircles; circleIndex++) {
                const x = startX + circleIndex * circleSpacing;
                const y = centerY;
                
                // í˜„ì¬ ì›ì— ê·¸ë ¤ì•¼ í•  ì¡°ê° ìˆ˜ ê²°ì •
                let slicesToFill;
                if (circleIndex < fullCircles) {
                    slicesToFill = denominator;  // ì™„ì „íˆ ì±„ì›Œì§„ ì›
                } else {
                    slicesToFill = remainder;  // ë‚˜ë¨¸ì§€ ì¡°ê°
                }
                
                // ì› ê·¸ë¦¬ê¸°
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, 2 * Math.PI);
                ctx.strokeStyle = '#333333';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // ë¶€ì±„ê¼´ë¡œ ë“±ë¶„í•˜ì—¬ ê·¸ë¦¬ê¸°
                const anglePerSlice = (2 * Math.PI) / denominator;
                
                for (let i = 0; i < denominator; i++) {
                    const startAngle = i * anglePerSlice - Math.PI / 2;  // ìœ„ìª½ë¶€í„° ì‹œì‘
                    const endAngle = (i + 1) * anglePerSlice - Math.PI / 2;
                    
                    // ì¡°ê° ê·¸ë¦¬ê¸°
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.arc(x, y, radius, startAngle, endAngle);
                    ctx.closePath();
                    
                    // ìƒ‰ì¹  ì—¬ë¶€ ê²°ì •
                    if (i < slicesToFill) {
                        // ìƒ‰ì¹ ëœ ì¡°ê° (ë°ì€ ì£¼í™©ìƒ‰ ë˜ëŠ” íŒŒë€ìƒ‰)
                        ctx.fillStyle = i % 2 === 0 ? '#FFB84D' : '#4A90E2';
                    } else {
                        // ìƒ‰ì¹ ë˜ì§€ ì•Šì€ ì¡°ê° (ì—°í•œ íšŒìƒ‰)
                        ctx.fillStyle = '#F0F0F0';
                    }
                    ctx.fill();
                    
                    // ê²½ê³„ì„  ê·¸ë¦¬ê¸°
                    ctx.strokeStyle = '#333333';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }
        }
        
        // ========== AI íŠœí„° í•¨ìˆ˜ ==========
        async function askAITutor() {
            const modal = document.getElementById('aiModal');
            const responseDiv = document.getElementById('aiResponse');
            
            // ëª¨ë‹¬ ì—´ê¸°
            modal.classList.add('active');
            responseDiv.textContent = 'ğŸ¤” ë¶„ìˆ˜ íƒí—˜ëŒ€ì¥ì´ ìƒê° ì¤‘ì´ì—ìš”...';
            
            // API Key í™•ì¸ (ì—¬ëŸ¬ ì†ŒìŠ¤ì—ì„œ ì‹œë„)
            const currentAPIKey = API_KEY_FINAL || window.VITE_OPENAI_API_KEY || import.meta.env.VITE_OPENAI_API_KEY;
            if (!currentAPIKey || currentAPIKey === 'your_api_key_here' || String(currentAPIKey).trim() === '') {
                responseDiv.innerHTML = `
                    <div class="text-red-500 mb-4">
                        âš ï¸ API Keyë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”!<br>
                        <code class="bg-gray-100 px-2 py-1 rounded">.env</code> íŒŒì¼ì— <code class="bg-gray-100 px-2 py-1 rounded">VITE_OPENAI_API_KEY=your_api_key</code>ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.
                    </div>
                    <div class="text-gray-600">
                        <strong>ì˜ˆì‹œ ì„¤ëª…:</strong><br>
                        í˜„ì¬ ë¶„ìˆ˜ëŠ” ${numerator}/${denominator}ì´ì—ìš”! ğŸ•<br>
                        ${denominator}ì¡°ê°ìœ¼ë¡œ ë‚˜ëˆˆ í”¼ìì—ì„œ ${numerator}ì¡°ê°ì„ ë¨¹ì—ˆë‹¤ëŠ” ëœ»ì´ì—ìš”!<br>
                        ${numerator >= denominator ? `ì™€! í”¼ì í•œ íŒì„ ë‹¤ ë¨¹ê³  ${numerator - denominator}ì¡°ê°ì„ ë” ë¨¹ì—ˆë„¤ìš”!` : 'ì•„ì§ ì¡°ê¸ˆ ë‚¨ì•˜ì–´ìš”!'}
                    </div>
                `;
                return;
            }
            
            try {
                const systemPrompt = `ë„ˆëŠ” ì´ˆë“±í•™ìƒ ìˆ˜í•™ íŠœí„° 'ë¶„ìˆ˜ íƒí—˜ëŒ€ì¥'ì´ì•¼.
ë§íˆ¬: ì¹œì ˆ, ìœ ì¾Œ, ì´ëª¨ì§€ ì‚¬ìš©.
ì„¤ëª…ë²•: 'í”¼ì'ì— ë¹„ìœ í•´ì„œ ì„¤ëª…. (ë¶„ëª¨=í”¼ì ì¡°ê° ìˆ˜, ë¶„ì=ë¨¹ì€ ìˆ˜).
ê°€ë¶„ìˆ˜ ì„¤ëª…: 5/4ë¼ë©´ 'í”¼ì í•œ íŒ ë‹¤ ë¨¹ê³  í•œ ì¡°ê° ë”!' ì‹ìœ¼ë¡œ ì‹œê°ì  ì„¤ëª….
ê¸¸ì´: 3ë¬¸ì¥ ì´ë‚´.`;
                
                const userPrompt = `í˜„ì¬ ë¶„ëª¨ëŠ” ${denominator}, ë¶„ìëŠ” ${numerator}ì´ì•¼. ê·¸ë¦¼ìœ¼ë¡œ ì›ì´ ê·¸ë ¤ì ¸ ìˆì–´. ì´ê²Œ ë¬´ìŠ¨ ëœ»ì¸ì§€ ì‰½ê²Œ ì„¤ëª…í•´ì¤˜.`;
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentAPIKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: userPrompt }
                        ],
                        max_tokens: 200,
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error('API ìš”ì²­ ì‹¤íŒ¨');
                }
                
                const data = await response.json();
                const aiMessage = data.choices[0].message.content;
                responseDiv.textContent = aiMessage;
                
            } catch (error) {
                console.error('AI íŠœí„° ì˜¤ë¥˜:', error);
                responseDiv.innerHTML = `
                    <div class="text-red-500">
                        ğŸ˜¢ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”: ${error.message}<br>
                        API Keyë¥¼ í™•ì¸í•˜ê±°ë‚˜ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
                    </div>
                `;
            }
        }
        
        // ========== AI ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜ ==========
        function closeAIModal() {
            const modal = document.getElementById('aiModal');
            modal.classList.remove('active');
        }
        
        // ========== ì „ì—­ í•¨ìˆ˜ë¡œ ë‚´ë³´ë‚´ê¸° (onclick ì†ì„± ì‚¬ìš©ì„ ìœ„í•´) ==========
        // showSectionì€ ì´ë¯¸ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì •ì˜ë˜ì—ˆìœ¼ë¯€ë¡œ ì˜¤ë²„ë¼ì´ë“œë§Œ ìˆ˜í–‰
        // window.showSectionì€ ì´ë¯¸ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì„¤ì •ë¨
        window.changeNumerator = changeNumerator;
        window.changeDenominator = changeDenominator;
        window.askAITutor = askAITutor;
        window.closeAIModal = closeAIModal;
        window.renderFraction = renderFraction;
        window.renderMixedFraction = renderMixedFraction;
        
        // ========== Section 2: ì¹´ë“œ ë’¤ì§‘ê¸° ê²Œì„ ==========
        let game1State = {
            cards: [],
            flippedCards: [],
            matchedPairs: 0,
            errors: 0,
            timer: null,
            timeLeft: 0,
            isFlipping: false,
            gameStarted: false
        };
        
        // ì¹´ë“œìš© ì‘ì€ Canvasì— ë¶„ìˆ˜ ê·¸ë¦¬ê¸°
        function drawFractionOnCard(canvas, num, den) {
            const ctx = canvas.getContext('2d');
            
            // Canvas í¬ê¸°ë¥¼ ì¹´ë“œ í¬ê¸°ì— ë§ê²Œ ì„¤ì •
            const container = canvas.parentElement;
            if (container) {
                const rect = container.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = rect.height;
            }
            
            const width = canvas.width;
            const height = canvas.height;
            
            // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            
            if (den === 0) return;
            
            const centerX = width / 2;
            const centerY = height / 2;
            
            // ê°€ë¶„ìˆ˜ ì²˜ë¦¬: ë¶„ìê°€ ë¶„ëª¨ë³´ë‹¤ í¬ë©´ ì—¬ëŸ¬ ê°œì˜ ì› ê·¸ë¦¬ê¸°
            const fullCircles = Math.floor(num / den);
            const remainder = num % den;
            const totalCircles = fullCircles + (remainder > 0 ? 1 : 0);
            
            // ë°˜ì§€ë¦„ ê·¹ëŒ€í™”: ìº”ë²„ìŠ¤ í¬ê¸°ì˜ 90% ì‚¬ìš©
            const minDimension = Math.min(width, height);
            const defaultGap = Math.max(4, minDimension * 0.05);  // ìµœì†Œ 4px, ìº”ë²„ìŠ¤ í¬ê¸°ì˜ 5%
            
            // ìµœëŒ€ ë°˜ì§€ë¦„ ê³„ì‚°: ì›ë“¤ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ” ìµœëŒ€ í¬ê¸°
            let maxRadius;
            if (totalCircles === 1) {
                // ì›ì´ 1ê°œë©´ ìº”ë²„ìŠ¤ì˜ 90% í¬ê¸°
                maxRadius = minDimension * 0.45;  // ì§€ë¦„ì´ 90%ê°€ ë˜ë„ë¡
            } else {
                // ì›ì´ 2ê°œ ì´ìƒì´ë©´ ê°„ê²©ì„ ê³ ë ¤í•˜ì—¬ ê³„ì‚°
                const availableWidth = width - (defaultGap * (totalCircles - 1));
                maxRadius = Math.min(
                    (availableWidth / totalCircles) / 2,  // ê°€ë¡œ ê¸°ì¤€
                    minDimension * 0.45  // ì„¸ë¡œ ê¸°ì¤€
                );
            }
            
            // ìµœëŒ€ ë°˜ì§€ë¦„ì˜ 90%ë¡œ ì„¤ì • (í…Œë‘ë¦¬ì— ê±°ì˜ ë‹¿ì„ ì •ë„)
            const radius = maxRadius * 0.9;
            const gap = defaultGap;
            
            // ì›ì˜ ì¤‘ì‹¬ ê°„ê²© ê³„ì‚° (ì§€ë¦„ + ê°„ê²©)
            const circleSpacing = radius * 2 + gap;
            
            // ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•œ ì‹œì‘ X ì¢Œí‘œ ê³„ì‚°
            const totalWidth = totalCircles * (radius * 2) + (totalCircles - 1) * gap;
            const startX = centerX - totalWidth / 2 + radius;
            
            for (let circleIndex = 0; circleIndex < totalCircles; circleIndex++) {
                const x = startX + circleIndex * circleSpacing;
                const y = centerY;
                
                let slicesToFill;
                if (circleIndex < fullCircles) {
                    slicesToFill = den;
                } else {
                    slicesToFill = remainder;
                }
                
                // ì› ê·¸ë¦¬ê¸°
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, 2 * Math.PI);
                ctx.strokeStyle = '#333333';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // ë¶€ì±„ê¼´ë¡œ ë“±ë¶„
                const anglePerSlice = (2 * Math.PI) / den;
                
                for (let i = 0; i < den; i++) {
                    const startAngle = i * anglePerSlice - Math.PI / 2;
                    const endAngle = (i + 1) * anglePerSlice - Math.PI / 2;
                    
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.arc(x, y, radius, startAngle, endAngle);
                    ctx.closePath();
                    
                    if (i < slicesToFill) {
                        ctx.fillStyle = i % 2 === 0 ? '#FFB84D' : '#4A90E2';
                    } else {
                        ctx.fillStyle = '#F0F0F0';
                    }
                    ctx.fill();
                    
                    ctx.strokeStyle = '#333333';
                    ctx.lineWidth = 1.5;
                    ctx.stroke();
                }
            }
        }
        
        // ê²Œì„ ë°ì´í„° ìƒì„±
        function generateGame1Data() {
            // ë¶„ëª¨ ë°°ì—´: 2ë¶€í„° 8ê¹Œì§€
            const denominators = [2, 3, 4, 5, 6, 7, 8];
            const pairs = [];
            
            // 6ìŒ ìƒì„±
            for (let i = 0; i < 6; i++) {
                // ë¶„ëª¨: 2~8 ì¤‘ ëœë¤ ì„ íƒ
                const den = denominators[Math.floor(Math.random() * denominators.length)];
                
                // ë¶„ì: 1 ì´ìƒ, ë¶„ëª¨Ã—2 ì´í•˜ (ëŒ€ë¶„ìˆ˜ë¡œ ë°”ê¿¨ì„ ë•Œ ìì—°ìˆ˜ ë¶€ë¶„ì´ 2 ì´í•˜)
                const maxNumerator = den * 2;
                const num = Math.floor(Math.random() * maxNumerator) + 1; // 1ë¶€í„° den*2ê¹Œì§€
                
                pairs.push({
                    id: i,
                    numerator: num,
                    denominator: den,
                    value: num / den  // ë¹„êµìš©
                });
            }
            
            // ì¹´ë“œ ë°°ì—´ ìƒì„± (ê° ìŒë§ˆë‹¤ ìˆ«ì ì¹´ë“œì™€ ê·¸ë¦¼ ì¹´ë“œ)
            const cards = [];
            pairs.forEach((pair, index) => {
                // ìˆ«ì ì¹´ë“œ
                cards.push({
                    id: `card-${index * 2}`,
                    pairId: index,
                    type: 'number',
                    numerator: pair.numerator,
                    denominator: pair.denominator,
                    value: pair.value
                });
                
                // ê·¸ë¦¼ ì¹´ë“œ
                cards.push({
                    id: `card-${index * 2 + 1}`,
                    pairId: index,
                    type: 'image',
                    numerator: pair.numerator,
                    denominator: pair.denominator,
                    value: pair.value
                });
            });
            
            // ì¹´ë“œ ì„ê¸°
            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cards[i], cards[j]] = [cards[j], cards[i]];
            }
            
            return cards;
        }
        
        // ì¹´ë“œ HTML ìƒì„±
        function createCardHTML(card, index) {
            const cardId = `game1-card-${index}`;
            let frontContent = '';
            
            if (card.type === 'number') {
                // ìˆ«ì ì¹´ë“œ - ì„¸ë¡œ ë¶„ìˆ˜ (í¬ê²Œ, íŒ¨ë”© ìµœì†Œí™”)
                frontContent = renderFraction(card.numerator, card.denominator, 'text-3xl md:text-5xl');
            } else {
                // ê·¸ë¦¼ ì¹´ë“œ - Canvas (ì¹´ë“œ í¬ê¸°ì— ë§ê²Œ)
                frontContent = `<canvas class="fraction-canvas w-full h-full" data-num="${card.numerator}" data-den="${card.denominator}"></canvas>`;
            }
            
            return `
                <div class="card-container">
                    <div class="card" id="${cardId}" data-index="${index}" data-pair-id="${card.pairId}" onclick="flipCard(${index})">
                        <div class="card-front p-1 md:p-2">
                            ${frontContent}
                        </div>
                        <div class="card-back"></div>
                    </div>
                </div>
            `;
        }
        
        // ê²Œì„ ì‹œì‘
        function startGame1() {
            // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
            game1State.cards = generateGame1Data();
            game1State.flippedCards = [];
            game1State.matchedPairs = 0;
            game1State.errors = 0;
            game1State.isFlipping = false;
            game1State.gameStarted = true;
            game1State.timeLeft = 120; // 2ë¶„
            
            // UI ì´ˆê¸°í™”
            const cardsContainer = document.getElementById('game1-cards');
            const successDiv = document.getElementById('game1-success');
            const startBtn = document.getElementById('game1-start-btn');
            
            cardsContainer.innerHTML = '';
            successDiv.classList.add('hidden');
            startBtn.disabled = true;
            startBtn.classList.add('opacity-50', 'cursor-not-allowed');
            
            // ì¹´ë“œ ìƒì„±
            game1State.cards.forEach((card, index) => {
                cardsContainer.innerHTML += createCardHTML(card, index);
            });
            
            // Canvasì— ê·¸ë¦¼ ê·¸ë¦¬ê¸° (ì¹´ë“œ í¬ê¸°ê°€ ê²°ì •ëœ í›„)
            setTimeout(() => {
                document.querySelectorAll('.fraction-canvas').forEach(canvas => {
                    const num = parseInt(canvas.dataset.num);
                    const den = parseInt(canvas.dataset.den);
                    drawFractionOnCard(canvas, num, den);
                });
            }, 200);
            
            // 2ì´ˆê°„ ì•ë©´ ë³´ì—¬ì£¼ê¸°
            setTimeout(() => {
                document.querySelectorAll('#game1-cards .card').forEach(cardEl => {
                    cardEl.classList.add('flipped');
                });
                
                setTimeout(() => {
                    document.querySelectorAll('#game1-cards .card').forEach(cardEl => {
                        cardEl.classList.remove('flipped');
                    });
                    
                    // íƒ€ì´ë¨¸ ì‹œì‘
                    startGame1Timer();
                }, 2000);
            }, 100);
            
            // ì—ëŸ¬ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
            document.getElementById('game1-errors').textContent = '0';
        }
        
        // íƒ€ì´ë¨¸ ì‹œì‘
        function startGame1Timer() {
            if (game1State.timer) {
                clearInterval(game1State.timer);
            }
            
            const timerEl = document.getElementById('game1-timer');
            timerEl.textContent = formatTime(game1State.timeLeft);
            
            game1State.timer = setInterval(() => {
                game1State.timeLeft--;
                timerEl.textContent = formatTime(game1State.timeLeft);
                
                if (game1State.timeLeft <= 0) {
                    clearInterval(game1State.timer);
                    endGame1(false);
                }
            }, 1000);
        }
        
        // ì‹œê°„ í¬ë§·íŒ…
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        // ì¹´ë“œ ë’¤ì§‘ê¸°
        function flipCard(index) {
            if (!game1State.gameStarted || game1State.isFlipping) return;
            
            const card = game1State.cards[index];
            const cardEl = document.getElementById(`game1-card-${index}`);
            
            // ì´ë¯¸ ë’¤ì§‘í˜”ê±°ë‚˜ ë§¤ì¹­ëœ ì¹´ë“œëŠ” ë¬´ì‹œ
            if (cardEl.classList.contains('flipped') || cardEl.classList.contains('matched')) {
                return;
            }
            
            // ì¹´ë“œ ë’¤ì§‘ê¸°
            cardEl.classList.add('flipped');
            game1State.flippedCards.push({ index, card });
            
            // ë‘ ì¥ì´ ë’¤ì§‘í˜”ìœ¼ë©´ ë¹„êµ
            if (game1State.flippedCards.length === 2) {
                game1State.isFlipping = true;
                
                setTimeout(() => {
                    checkMatch();
                }, 500);
            }
        }
        
        // ì¹´ë“œ ë§¤ì¹­ í™•ì¸
        function checkMatch() {
            const [first, second] = game1State.flippedCards;
            const firstCard = game1State.cards[first.index];
            const secondCard = game1State.cards[second.index];
            
            const firstEl = document.getElementById(`game1-card-${first.index}`);
            const secondEl = document.getElementById(`game1-card-${second.index}`);
            
            // ê°™ì€ ìŒì¸ì§€ í™•ì¸ (pairIdê°€ ê°™ê³ , íƒ€ì…ì´ ë‹¤ë¦„)
            if (firstCard.pairId === secondCard.pairId && firstCard.type !== secondCard.type) {
                // ì •ë‹µ!
                firstEl.classList.add('matched', 'correct-animation');
                secondEl.classList.add('matched', 'correct-animation');
                
                // ì •ë‹µ íš¨ê³¼
                showFeedback('ë”©ë™ëŒ•! ğŸ‰', 'green');
                
                game1State.matchedPairs++;
                
                // ëª¨ë“  ìŒì„ ë§ì·„ëŠ”ì§€ í™•ì¸
                if (game1State.matchedPairs === 6) {
                    setTimeout(() => {
                        endGame1(true);
                    }, 1000);
                }
            } else {
                // ì˜¤ë‹µ!
                game1State.errors++;
                document.getElementById('game1-errors').textContent = game1State.errors;
                
                firstEl.classList.add('incorrect-animation');
                secondEl.classList.add('incorrect-animation');
                
                showFeedback('ë•¡! ğŸ˜¢', 'red');
                
                // 1ì´ˆ í›„ ë‹¤ì‹œ ë’¤ì§‘ê¸°
                setTimeout(() => {
                    firstEl.classList.remove('flipped', 'incorrect-animation');
                    secondEl.classList.remove('flipped', 'incorrect-animation');
                }, 1000);
            }
            
            // ì´ˆê¸°í™”
            game1State.flippedCards = [];
            
            setTimeout(() => {
                game1State.isFlipping = false;
            }, 1200);
        }
        
        // í”¼ë“œë°± í‘œì‹œ
        function showFeedback(message, color) {
            const feedback = document.createElement('div');
            feedback.textContent = message;
            feedback.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-4xl font-bold z-50 pointer-events-none';
            feedback.style.color = color === 'green' ? '#10b981' : '#ef4444';
            feedback.style.animation = 'fadeInOut 1s';
            feedback.style.textShadow = '0 2px 4px rgba(0,0,0,0.3)';
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                feedback.remove();
            }, 1000);
        }
        
        // ê²Œì„ ì¢…ë£Œ
        function endGame1(success) {
            if (game1State.timer) {
                clearInterval(game1State.timer);
            }
            
            game1State.gameStarted = false;
            const startBtn = document.getElementById('game1-start-btn');
            startBtn.disabled = false;
            startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            
            if (success) {
                const successDiv = document.getElementById('game1-success');
                const resultEl = document.getElementById('game1-result');
                const timeUsed = 120 - game1State.timeLeft;
                resultEl.textContent = `í‹€ë¦° íšŸìˆ˜: ${game1State.errors}íšŒ, ì†Œìš” ì‹œê°„: ${formatTime(timeUsed)}`;
                successDiv.classList.remove('hidden');
            } else {
                alert('ì‹œê°„ì´ ë‹¤ ë˜ì—ˆì–´ìš”! ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!');
            }
        }
        
        // ì „ì—­ í•¨ìˆ˜ë¡œ ë‚´ë³´ë‚´ê¸°
        window.startGame1 = startGame1;
        window.flipCard = flipCard;
        
        // ========== Section 3: ë¶„ìˆ˜ ë¬´í•œì˜ ê³„ë‹¨ ==========
        let game2State = {
            canvas: null,
            ctx: null,
            currentStep: 0,
            TARGET_STEP: 100,
            isQuizActive: false,
            cameraY: 0,
            charJumpOffset: 0,
            isJumping: false,
            animationId: null
        };
        
        // ê²Œì„ ì´ˆê¸°í™”
        function initGame2() {
            const canvas = document.getElementById('game2-canvas');
            if (!canvas) return;
            
            function resize() {
                canvas.width = canvas.parentElement.clientWidth;
                canvas.height = canvas.parentElement.clientHeight;
            }
            window.addEventListener('resize', resize);
            resize();
            
            game2State.canvas = canvas;
            game2State.ctx = canvas.getContext('2d');
        }
        
        // ê²Œì„ ì‹œì‘
        function startGame2() {
            initGame2();
            
            game2State.currentStep = 0;
            game2State.isQuizActive = false;
            game2State.cameraY = 0;
            game2State.charJumpOffset = 0;
            game2State.isJumping = false;
            
            const scoreBoard = document.getElementById('score-board');
            if (scoreBoard) scoreBoard.innerText = '0 F';
            
            const quizModal = document.getElementById('quiz-modal');
            if (quizModal) quizModal.style.display = 'none';
            
            draw();
        }
        
        // ê·¸ë¦¬ê¸° í•¨ìˆ˜
        function draw() {
            const ctx = game2State.ctx;
            const canvas = game2State.canvas;
            if (!ctx || !canvas) return;
            
            ctx.fillStyle = "#E0F7FA";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2 + 100;

            // ê³„ë‹¨ ê·¸ë¦¬ê¸°
            ctx.fillStyle = "#8D6E63";
            ctx.strokeStyle = "#5D4037";
            const visibleSteps = 15;
            const stepWidth = 60;
            const stepHeight = 40;

            for (let i = game2State.currentStep - 5; i < game2State.currentStep + visibleSteps; i++) {
                if (i < 0) continue;

                const stepRelIndex = i - game2State.currentStep; 
                const x = centerX + (stepRelIndex * stepWidth);
                const y = centerY - (stepRelIndex * stepHeight) + game2State.cameraY;

                ctx.beginPath();
                ctx.rect(x - stepWidth/2, y, stepWidth, stepHeight);
                ctx.fill();
                ctx.stroke();

                ctx.fillStyle = "#6D4C41";
                ctx.beginPath();
                ctx.rect(x - stepWidth/2, y + stepHeight, stepWidth, stepHeight);
                ctx.fill();
                ctx.stroke();
                
                ctx.fillStyle = "#8D6E63";

                if (i === 100) {
                    ctx.fillStyle = "red";
                    ctx.font = "30px Arial";
                    ctx.fillText("ğŸš©", x - 15, y - 10);
                }
            }

            // ìºë¦­í„° ê·¸ë¦¬ê¸°
            const charScreenX = centerX;
            const charScreenY = centerY + game2State.cameraY - game2State.charJumpOffset; 
            
            ctx.fillStyle = "rgba(0,0,0,0.2)";
            ctx.beginPath();
            ctx.ellipse(charScreenX, centerY + stepHeight/2, 20, 10, 0, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = "#FF7043";
            ctx.beginPath();
            ctx.arc(charScreenX, charScreenY - 20, 25, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(charScreenX - 8, charScreenY - 25, 8, 0, Math.PI * 2);
            ctx.arc(charScreenX + 8, charScreenY - 25, 8, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.arc(charScreenX - 8, charScreenY - 25, 3, 0, Math.PI * 2);
            ctx.arc(charScreenX + 8, charScreenY - 25, 3, 0, Math.PI * 2);
            ctx.fill();

            game2State.animationId = requestAnimationFrame(draw);
        }

        // ì• ë‹ˆë©”ì´ì…˜ ë° ê²Œì„ ë¡œì§
        function animateStep() {
            if (game2State.isJumping) return;
            game2State.isJumping = true;
            
            let progress = 0;
            const duration = 150;
            const startTime = performance.now();

            function loop(time) {
                const elapsed = time - startTime;
                progress = Math.min(elapsed / duration, 1);
                game2State.charJumpOffset = Math.sin(progress * Math.PI) * 40;
                
                if (progress < 1) {
                    requestAnimationFrame(loop);
                } else {
                    game2State.isJumping = false;
                    game2State.charJumpOffset = 0;
                }
            }
            requestAnimationFrame(loop);
        }

        function climb() {
            if (game2State.isQuizActive || game2State.currentStep >= game2State.TARGET_STEP) return;

            game2State.currentStep++;
            const scoreBoard = document.getElementById('score-board');
            if (scoreBoard) scoreBoard.innerText = `${game2State.currentStep} F`;
            animateStep();

            if (game2State.currentStep >= game2State.TARGET_STEP) {
                setTimeout(() => alert("ğŸ‰ 100ê³„ë‹¨ ì •ë³µ ì„±ê³µ! ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰"), 100);
                return;
            }

            if (game2State.currentStep % 5 === 0) {
                setTimeout(showQuiz, 300);
            }
        }

        function superJump(bonusSteps) {
            const jumpMsg = document.getElementById('jump-msg');
            if (jumpMsg) {
                jumpMsg.style.display = 'block';
                jumpMsg.innerText = `+${bonusSteps} JUMP!`;
                
                setTimeout(() => { jumpMsg.style.display = 'none'; }, 1000);
            }

            let count = 0;
            const interval = setInterval(() => {
                game2State.currentStep++;
                const scoreBoard = document.getElementById('score-board');
                if (scoreBoard) scoreBoard.innerText = `${game2State.currentStep} F`;
                animateStep();
                count++;
                
                if (game2State.currentStep >= game2State.TARGET_STEP) {
                    clearInterval(interval);
                    setTimeout(() => alert("ğŸ‰ 100ê³„ë‹¨ ì •ë³µ ì„±ê³µ! ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰"), 500);
                }
                
                if (count >= bonusSteps) clearInterval(interval);
            }, 200);
        }

        // ë¬¸ì œ ìƒì„±ê¸° (ë¶„ìˆ˜ ë§ì…ˆ)
        function generateProblem() {
            const denom = Math.floor(Math.random() * 8) + 2; 
            const num1 = Math.floor(Math.random() * (denom - 1)) + 1;
            const num2 = Math.floor(Math.random() * (denom - 1)) + 1;
            
            let ansNum = num1 + num2;
            let ansDenom = denom;
            
            const integer = Math.floor(ansNum / ansDenom);
            const properNum = ansNum % ansDenom;

            return {
                q: { n1: num1, n2: num2, d: denom },
                a: { int: integer, n: properNum, d: ansDenom } 
            };
        }

        function fractionToHtml(n, d, int=0) {
            let html = '<div class="fraction" style="display: inline-block; vertical-align: middle; text-align: center; font-size: 2rem;">';
            if (int > 0) html += `<span style="font-size:2rem; margin-right:5px;">${int}</span>`;
            if (n > 0 || int === 0 && n === 0) {
                 if (n === 0 && int > 0) {
                     // ì •ìˆ˜ë§Œ ìˆëŠ” ê²½ìš°
                 } else {
                     if (n === 0) { /* 0ì¸ ê²½ìš° */ }
                     else {
                        html += `<div style="display:inline-block; vertical-align:middle;">
                                    <span style="border-bottom: 3px solid #333; display: block; padding: 0 5px;">${n}</span>
                                    <span style="display: block; padding: 0 5px;">${d}</span>
                                </div>`;
                     }
                 }
            }
            if (int === 0 && n === 0) html += "0";
            
            html += '</div>';
            return html;
        }

        function showQuiz() {
            game2State.isQuizActive = true;
            const quizModal = document.getElementById('quiz-modal');
            const quizContent = document.getElementById('quiz-content');
            const quizOptions = document.getElementById('quiz-options');
            
            if (!quizModal || !quizContent || !quizOptions) return;
            
            quizModal.style.display = 'flex';
            
            const problem = generateProblem();
            
            const qHtml = `${fractionToHtml(problem.q.n1, problem.q.d)} + ${fractionToHtml(problem.q.n2, problem.q.d)} = ?`;
            quizContent.innerHTML = qHtml;

            let options = [];
            
            options.push({ 
                html: fractionToHtml(problem.a.n, problem.a.d, problem.a.int), 
                isCorrect: true 
            });

            while (options.length < 4) {
                let wrongNum = problem.q.n1 + problem.q.n2 + Math.floor(Math.random() * 5) - 2;
                if (wrongNum === problem.q.n1 + problem.q.n2) wrongNum += 1;
                if (wrongNum <= 0) wrongNum = 1;

                const wInt = Math.floor(wrongNum / problem.q.d);
                const wN = wrongNum % problem.q.d;
                
                const wHtml = fractionToHtml(wN, problem.q.d, wInt);
                if (!options.some(o => o.html === wHtml)) {
                    options.push({ html: wHtml, isCorrect: false });
                }
            }

            options.sort(() => Math.random() - 0.5);

            quizOptions.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.style.cssText = 'padding: 15px; font-size: 1.5rem; background-color: #FFeb3b; border: 3px solid #FBC02D; border-radius: 10px; cursor: pointer; font-family: Jua, sans-serif;';
                btn.innerHTML = opt.html;
                btn.onclick = () => checkAnswer(opt.isCorrect);
                quizOptions.appendChild(btn);
            });
        }

        function checkAnswer(isCorrect) {
            if (isCorrect) {
                const quizModal = document.getElementById('quiz-modal');
                if (quizModal) quizModal.style.display = 'none';
                game2State.isQuizActive = false;
                const bonus = Math.floor(Math.random() * 9) + 2; 
                superJump(bonus);
            } else {
                alert("í‹€ë ¸ìŠµë‹ˆë‹¤! ë‹¤ì‹œ í’€ì–´ë³´ì„¸ìš”.");
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        const climbBtn = document.getElementById('climb-btn');
        if (climbBtn) {
            climbBtn.addEventListener('click', climb);
        }
        
        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && !game2State.isQuizActive) climb();
        });
        
        // ========== Section 4: ì§€êµ¬ë¥¼ ì§€ì¼œë¼! ë¶„ìˆ˜ ëŒ€ì „ìŸ ==========
        const game3Canvas = document.getElementById('game3-canvas');
        const game3Ctx = game3Canvas?.getContext('2d');
        const game3LivesEl = document.getElementById('lives');
        const game3TimerEl = document.getElementById('timer');
        const game3TimerBox = document.getElementById('timer-box');
        const game3StageNumEl = document.getElementById('stage-num');
        const game3Overlay = document.getElementById('screen-overlay');
        const game3OverlayContent = document.getElementById('overlay-text');
        const game3TargetBadge = document.getElementById('target-badge');
        const game3StageBanner = document.getElementById('stage-banner');

        let game3State = {
            gameRunning: false,
            lives: 3,
            frameCount: 0,
            timeLeft: 60,
            timerInterval: null,
            currentLevel: 1,
            currentTarget: 'proper',
            stage3SwitchTimer: 0,
            player: null,
            bullets: [],
            enemies: [],
            particles: []
        };

        function resizeGame3() {
            if (!game3Canvas) return;
            game3Canvas.width = game3Canvas.parentElement.clientWidth;
            game3Canvas.height = game3Canvas.parentElement.clientHeight;
        }
        window.addEventListener('resize', resizeGame3);

        // í”Œë ˆì´ì–´
        function createPlayer() {
            return {
                x: game3Canvas.width / 2,
                y: game3Canvas.height - 80,
                width: 50,
                height: 50,
                speed: 7,
                dx: 0,
                draw() {
                    game3Ctx.save();
                    game3Ctx.translate(this.x, this.y);
                    game3Ctx.fillStyle = "#dfe6e9";
                    game3Ctx.beginPath();
                    game3Ctx.moveTo(0, -this.height/2);
                    game3Ctx.lineTo(-this.width/2, this.height/2);
                    game3Ctx.lineTo(this.width/2, this.height/2);
                    game3Ctx.closePath();
                    game3Ctx.fill();
                    game3Ctx.fillStyle = "#74b9ff";
                    game3Ctx.beginPath();
                    game3Ctx.arc(0, 0, 10, 0, Math.PI*2);
                    game3Ctx.fill();
                    game3Ctx.fillStyle = "#ff7675";
                    game3Ctx.beginPath();
                    game3Ctx.moveTo(-10, this.height/2);
                    game3Ctx.lineTo(0, this.height/2 + (Math.random()*15 + 5)); 
                    game3Ctx.lineTo(10, this.height/2);
                    game3Ctx.fill();
                    game3Ctx.restore();
                },
                update() {
                    this.x += this.dx;
                    if (this.x < this.width/2) this.x = this.width/2;
                    if (this.x > game3Canvas.width - this.width/2) this.x = game3Canvas.width - this.width/2;
                }
            };
        }

        // ì´ì•Œ
        class Bullet {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.speed = 10;
                this.radius = 5;
            }
            draw() {
                game3Ctx.fillStyle = "#ffeaa7";
                game3Ctx.beginPath();
                game3Ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
                game3Ctx.fill();
            }
            update() {
                this.y -= this.speed;
            }
        }

        // ì  (ë¶„ìˆ˜ ìš´ì„)
        class Enemy {
            constructor() {
                this.radius = 35;
                this.x = Math.random() * (game3Canvas.width - this.radius * 2) + this.radius;
                this.y = -50;
                this.speed = Math.random() * 1.5 + 1; 
                
                this.denom = Math.floor(Math.random() * 7) + 2; 
                this.num = Math.floor(Math.random() * (this.denom * 2)) + 1;

                this.text = `${this.num}/${this.denom}`;
                this.isProper = (this.num < this.denom);
                this.isImproper = (this.num >= this.denom);
            }

            draw() {
                game3Ctx.save();
                game3Ctx.translate(this.x, this.y);
                if (this.isImproper) game3Ctx.fillStyle = "#ff6b6b";
                else game3Ctx.fillStyle = "#00d2d3";

                game3Ctx.beginPath();
                game3Ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
                game3Ctx.fill();
                game3Ctx.strokeStyle = "#fff";
                game3Ctx.lineWidth = 2;
                game3Ctx.stroke();

                game3Ctx.fillStyle = "#fff";
                game3Ctx.font = "bold 20px Arial";
                game3Ctx.textAlign = "center";
                game3Ctx.textBaseline = "middle";
                game3Ctx.beginPath();
                game3Ctx.moveTo(-15, 0);
                game3Ctx.lineTo(15, 0);
                game3Ctx.strokeStyle = "white";
                game3Ctx.stroke();

                game3Ctx.font = "16px 'Jua'";
                game3Ctx.fillText(this.num, 0, -12);
                game3Ctx.fillText(this.denom, 0, 14);
                game3Ctx.restore();
            }
            update() { this.y += this.speed; }
        }

        // íŒŒí‹°í´
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.radius = Math.random() * 3 + 1;
                this.speedX = Math.random() * 4 - 2;
                this.speedY = Math.random() * 4 - 2;
                this.alpha = 1;
                this.color = color;
            }
            draw() {
                game3Ctx.save();
                game3Ctx.globalAlpha = this.alpha;
                game3Ctx.fillStyle = this.color;
                game3Ctx.beginPath();
                game3Ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
                game3Ctx.fill();
                game3Ctx.restore();
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.alpha -= 0.02;
            }
        }

        function createExplosion(x, y, color) {
            for(let i=0; i<15; i++) {
                game3State.particles.push(new Particle(x, y, color));
            }
        }

        function spawnEnemy() {
            if (game3State.frameCount % 60 === 0) game3State.enemies.push(new Enemy());
        }

        function updateGameLogic() {
            if (game3State.currentLevel === 1) {
                game3State.currentTarget = 'proper';
                setUiForTarget('proper');
                game3StageBanner.innerText = "STAGE 1";
            } else if (game3State.currentLevel === 2) {
                game3State.currentTarget = 'improper';
                setUiForTarget('improper');
                game3StageBanner.innerText = "STAGE 2";
                game3StageBanner.style.color = "rgba(255, 107, 107, 0.2)";
            } else if (game3State.currentLevel === 3) {
                game3StageBanner.innerText = "STAGE 3";
                game3StageBanner.style.color = "rgba(255, 215, 0, 0.2)";
                
                game3State.stage3SwitchTimer++;
                if (game3State.stage3SwitchTimer > 180) {
                    toggleTarget();
                    game3State.stage3SwitchTimer = 0;
                    game3TargetBadge.style.transform = "scale(1.2)";
                    setTimeout(() => game3TargetBadge.style.transform = "scale(1)", 200);
                }
            }
        }

        function setUiForTarget(type) {
            if (type === 'proper') {
                game3TargetBadge.innerText = "ì§„ë¶„ìˆ˜";
                game3TargetBadge.className = "target-badge badge-proper";
                game3TargetBadge.style.cssText = "background-color: #00d2d3; color: white; border-color: #01a3a4; padding: 10px 20px; border-radius: 5px; font-family: 'Black Han Sans', sans-serif; font-size: 1.8rem; box-shadow: 3px 3px 0 rgba(0,0,0,0.3); border: 3px solid #01a3a4; transition: all 0.3s; text-align: center; min-width: 120px;";
            } else {
                game3TargetBadge.innerText = "ê°€ë¶„ìˆ˜";
                game3TargetBadge.className = "target-badge badge-improper";
                game3TargetBadge.style.cssText = "background-color: #ff6b6b; color: white; border-color: #ee5253; padding: 10px 20px; border-radius: 5px; font-family: 'Black Han Sans', sans-serif; font-size: 1.8rem; box-shadow: 3px 3px 0 rgba(0,0,0,0.3); border: 3px solid #ee5253; transition: all 0.3s; text-align: center; min-width: 120px;";
            }
        }

        function toggleTarget() {
            if (game3State.currentTarget === 'proper') {
                game3State.currentTarget = 'improper';
                setUiForTarget('improper');
            } else {
                game3State.currentTarget = 'proper';
                setUiForTarget('proper');
            }
        }

        function checkCollisions() {
            for (let i = game3State.bullets.length - 1; i >= 0; i--) {
                for (let j = game3State.enemies.length - 1; j >= 0; j--) {
                    const b = game3State.bullets[i];
                    const e = game3State.enemies[j];
                    const dist = Math.hypot(b.x - e.x, b.y - e.y);
                    
                    if (dist < e.radius + b.radius) {
                        let isCorrectTarget = false;
                        if (game3State.currentTarget === 'proper' && e.isProper) isCorrectTarget = true;
                        if (game3State.currentTarget === 'improper' && e.isImproper) isCorrectTarget = true;

                        if (isCorrectTarget) {
                            createExplosion(e.x, e.y, "#ffd700");
                        } else {
                            game3State.lives--;
                            updateLives();
                            createExplosion(e.x, e.y, "#ff0000");
                            game3Canvas.style.transform = "translate(5px, 5px)";
                            setTimeout(() => game3Canvas.style.transform = "none", 100);
                        }
                        game3State.bullets.splice(i, 1);
                        game3State.enemies.splice(j, 1);
                        break;
                    }
                }
            }
            for (let i = game3State.enemies.length - 1; i >= 0; i--) {
                if (game3State.enemies[i].y > game3Canvas.height + 50) game3State.enemies.splice(i, 1);
            }
        }

        function updateLives() {
            let hearts = "";
            for(let i=0; i<game3State.lives; i++) hearts += "â¤ï¸";
            game3LivesEl.innerText = hearts;
            if (game3State.lives <= 0) handleGameOver(false);
        }

        function runTimer() {
            game3State.timeLeft = 60;
            game3TimerEl.innerText = game3State.timeLeft;
            game3TimerBox.classList.remove('timer-warning');

            if (game3State.timerInterval) clearInterval(game3State.timerInterval);
            
            game3State.timerInterval = setInterval(() => {
                if (!game3State.gameRunning) {
                    clearInterval(game3State.timerInterval);
                    return;
                }
                game3State.timeLeft--;
                game3TimerEl.innerText = game3State.timeLeft;

                if (game3State.timeLeft <= 10) game3TimerBox.classList.add('timer-warning');

                if (game3State.timeLeft <= 0) {
                    handleStageClear();
                }
            }, 1000);
        }

        function gameLoop() {
            if (!game3State.gameRunning || !game3Ctx || !game3Canvas) return;

            game3Ctx.fillStyle = "rgba(0, 0, 0, 0.3)"; 
            game3Ctx.fillRect(0, 0, game3Canvas.width, game3Canvas.height);
            if (Math.random() < 0.1) {
                game3Ctx.fillStyle = "white";
                game3Ctx.fillRect(Math.random()*game3Canvas.width, Math.random()*game3Canvas.height, 2, 2);
            }

            game3State.player.update();
            game3State.player.draw();

            game3State.bullets.forEach((b, index) => {
                b.update();
                b.draw();
                if (b.y < 0) game3State.bullets.splice(index, 1);
            });

            spawnEnemy();
            game3State.enemies.forEach((e) => {
                e.update();
                e.draw();
            });

            game3State.particles.forEach((p, index) => {
                p.update();
                p.draw();
                if (p.alpha <= 0) game3State.particles.splice(index, 1);
            });

            updateGameLogic(); 
            checkCollisions();
            
            game3State.frameCount++;
            requestAnimationFrame(gameLoop);
        }

        function startStage(level) {
            if (!game3Canvas || !game3Ctx) return;
            
            resizeGame3();
            game3State.gameRunning = true;
            game3State.currentLevel = level;
            
            game3State.lives = 3; 
            game3State.timeLeft = 60;
            game3State.enemies = [];
            game3State.bullets = [];
            game3State.particles = [];
            
            updateLives();
            game3StageNumEl.innerText = game3State.currentLevel;
            game3Overlay.style.display = 'none';
            game3State.player = createPlayer();
            game3State.player.x = game3Canvas.width / 2;

            if (level === 3) {
                game3State.stage3SwitchTimer = 0;
                game3State.currentTarget = 'proper'; 
            }

            runTimer();
            gameLoop();
        }
        window.startStage = startStage;

        function handleStageClear() {
            game3State.gameRunning = false;
            clearInterval(game3State.timerInterval);
            game3Overlay.style.display = 'flex';

            if (game3State.currentLevel === 1) {
                game3OverlayContent.innerHTML = `
                    <h1 style="color:#00d4ff; font-family: 'Black Han Sans', sans-serif; font-size: 3rem; margin-bottom: 20px;">ğŸ‰ 1ë‹¨ê³„ ì„±ê³µ! ğŸ‰</h1>
                    <p style="text-align: center; font-size: 1.3rem; margin-bottom: 10px; color: #ccc; line-height: 1.6;">ì§„ë¶„ìˆ˜ ê³µê²© ì„±ê³µ!<br>ì´ì œ <strong>ê°€ë¶„ìˆ˜</strong>ê°€ ëª°ë ¤ì˜µë‹ˆë‹¤.</p>
                    <button class="start-btn" onclick="startStage(2)" style="padding: 15px 40px; font-size: 1.8rem; font-family: 'Black Han Sans', sans-serif; background-color: #ff4757; color: white; border: none; border-radius: 10px; cursor: pointer; box-shadow: 0 5px 0 #c0392b; transition: transform 0.1s; pointer-events: auto; z-index: 101; margin-top: 20px;">2ë‹¨ê³„ ë„ì „!</button>
                `;
            } else if (game3State.currentLevel === 2) {
                game3OverlayContent.innerHTML = `
                    <h1 style="color:#ff6b6b; font-family: 'Black Han Sans', sans-serif; font-size: 3rem; margin-bottom: 20px;">ğŸ‰ 2ë‹¨ê³„ ì„±ê³µ! ğŸ‰</h1>
                    <p style="text-align: center; font-size: 1.3rem; margin-bottom: 10px; color: #ccc; line-height: 1.6;">ê°€ë¶„ìˆ˜ ê³µê²© ì„±ê³µ!<br>ì´ì œ <strong>ì§„ë¶„ìˆ˜ì™€ ê°€ë¶„ìˆ˜</strong>ê°€<br>ë²ˆê°ˆì•„ ë‚˜ì˜µë‹ˆë‹¤!</p>
                    <button class="start-btn" onclick="startStage(3)" style="padding: 15px 40px; font-size: 1.8rem; font-family: 'Black Han Sans', sans-serif; background-color: #ff4757; color: white; border: none; border-radius: 10px; cursor: pointer; box-shadow: 0 5px 0 #c0392b; transition: transform 0.1s; pointer-events: auto; z-index: 101; margin-top: 20px;">ë§ˆì§€ë§‰ ë„ì „!</button>
                `;
            } else {
                game3OverlayContent.innerHTML = `
                    <h1 style="color:#ffd700; font-family: 'Black Han Sans', sans-serif; font-size: 3rem; margin-bottom: 20px;">ğŸ† ì§€êµ¬ ë°©ìœ„ ì„±ê³µ! ğŸ†</h1>
                    <p style="text-align: center; font-size: 1.3rem; margin-bottom: 10px; color: #ccc; line-height: 1.6;">ëª¨ë“  ë¶„ìˆ˜ ê³µê²©ì„ ë§‰ì•„ëƒˆìŠµë‹ˆë‹¤!<br>ë‹¹ì‹ ì€ ìµœê³ ì˜ ìš°ì£¼ ì¡°ì¢…ì‚¬!</p>
                    <button class="start-btn" onclick="showGame3Intro()" style="padding: 15px 40px; font-size: 1.8rem; font-family: 'Black Han Sans', sans-serif; background-color: #ff4757; color: white; border: none; border-radius: 10px; cursor: pointer; box-shadow: 0 5px 0 #c0392b; transition: transform 0.1s; pointer-events: auto; z-index: 101; margin-top: 20px;">ì²˜ìŒìœ¼ë¡œ</button>
                `;
            }
        }

        function handleGameOver() {
            game3State.gameRunning = false;
            clearInterval(game3State.timerInterval);
            game3Overlay.style.display = 'flex';
            game3OverlayContent.innerHTML = `
                <h1 style="color:#ff4757; font-family: 'Black Han Sans', sans-serif; font-size: 3rem; margin-bottom: 20px;">ğŸ’€ ê²Œì„ ì˜¤ë²„ ğŸ’€</h1>
                <p style="text-align: center; font-size: 1.3rem; margin-bottom: 10px; color: #ccc; line-height: 1.6;">ì•„ì‰½ê²Œ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br>ë‹¤ì‹œ ë„ì „í•´ ë³¼ê¹Œìš”?</p>
                <button class="start-btn" onclick="startStage(${game3State.currentLevel})" style="padding: 15px 40px; font-size: 1.8rem; font-family: 'Black Han Sans', sans-serif; background-color: #ff4757; color: white; border: none; border-radius: 10px; cursor: pointer; box-shadow: 0 5px 0 #c0392b; transition: transform 0.1s; pointer-events: auto; z-index: 101; margin-top: 20px;">ì¬ë„ì „</button>
            `;
        }

        function showGame3Intro() {
            game3Overlay.style.display = 'flex';
            game3OverlayContent.innerHTML = `
                <h1 style="color:#ffd700; font-family: 'Black Han Sans', sans-serif; font-size: 3rem; margin-bottom: 20px; line-height: 1.2;">ì§€êµ¬ë¥¼ ì§€ì¼œë¼!<br>ë¶„ìˆ˜ ëŒ€ì „ìŸ</h1>
                <p style="text-align: center; font-size: 1.3rem; margin-bottom: 10px; color: #ccc; line-height: 1.6;">
                    <strong>ì´ 3ë‹¨ê³„ ë¯¸ì…˜</strong>ì„ ì™„ë£Œí•˜ì„¸ìš”.<br>
                    <span style="color:#00d4ff">1ë‹¨ê³„: ì§„ë¶„ìˆ˜</span> / 
                    <span style="color:#ff6b6b">2ë‹¨ê³„: ê°€ë¶„ìˆ˜</span> / 
                    <span style="color:#ffd700">3ë‹¨ê³„: í˜¼í•©</span>
                </p>
                <button class="start-btn" onclick="startStage(1)" style="padding: 15px 40px; font-size: 1.8rem; font-family: 'Black Han Sans', sans-serif; background-color: #ff4757; color: white; border: none; border-radius: 10px; cursor: pointer; box-shadow: 0 5px 0 #c0392b; transition: transform 0.1s; pointer-events: auto; z-index: 101; margin-top: 20px;">1ë‹¨ê³„ ì¶œê²©!</button>
            `;
        }
        window.showGame3Intro = showGame3Intro;

        const game3Keys = {};
        document.addEventListener('keydown', e => {
            if (!game3State.gameRunning || !game3State.player) return;
            game3Keys[e.code] = true;
            if (e.code === 'ArrowLeft') game3State.player.dx = -game3State.player.speed;
            if (e.code === 'ArrowRight') game3State.player.dx = game3State.player.speed;
            if (e.code === 'Space') game3State.bullets.push(new Bullet(game3State.player.x, game3State.player.y - 20));
        });
        document.addEventListener('keyup', e => {
            if (!game3State.gameRunning || !game3State.player) return;
            game3Keys[e.code] = false;
            if (e.code === 'ArrowLeft' || e.code === 'ArrowRight') game3State.player.dx = 0;
            if (game3Keys['ArrowLeft']) game3State.player.dx = -game3State.player.speed;
            if (game3Keys['ArrowRight']) game3State.player.dx = game3State.player.speed;
        });
        
        game3Canvas?.addEventListener('touchstart', e => { e.preventDefault(); handleTouch(e.touches[0].clientX); });
        game3Canvas?.addEventListener('touchmove', e => { e.preventDefault(); handleTouch(e.touches[0].clientX); });
        game3Canvas?.addEventListener('touchend', () => { if (game3State.player) game3State.player.dx = 0; });
        function handleTouch(touchX) {
            if (!game3State.gameRunning || !game3State.player) return;
            if (touchX < window.innerWidth / 2 - 50) game3State.player.dx = -game3State.player.speed;
            else if (touchX > window.innerWidth / 2 + 50) game3State.player.dx = game3State.player.speed; 
            else game3State.bullets.push(new Bullet(game3State.player.x, game3State.player.y - 20));
        }

        // ========== ì´ˆê¸°í™” ==========
        document.addEventListener('DOMContentLoaded', async function() {
            showSection('home');
            updateDisplay();
            drawFraction();
            
            // API Key ê²€ì¦
            await checkAPIKey();
        });
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('aiModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeAIModal();
            }
        });
    </script>
</body>
</html>
