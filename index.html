<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¡°ê°ì¡°ê° ë¶„ìˆ˜ë‚˜ë¼</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts - Jua -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    
    <style>
        * {
            font-family: 'Jua', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #e0f2fe 0%, #fef3c7 100%);
            min-height: 100vh;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .menu-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .menu-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .btn-primary {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        /* Canvas ìŠ¤íƒ€ì¼ */
        #fractionCanvas {
            border-radius: 1rem;
            background-color: white;
        }
        
        /* ì„¸ë¡œ ë¶„ìˆ˜ ìŠ¤íƒ€ì¼ */
        .fraction-vertical {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .fraction-numerator {
            font-weight: bold;
            line-height: 1.2;
            padding-bottom: 2px;
        }
        
        .fraction-line {
            width: 100%;
            border-bottom: 2.5px solid currentColor;
            margin: 4px 0;
            min-width: 50px;
            align-self: stretch;
        }
        
        .fraction-denominator {
            font-weight: bold;
            line-height: 1.2;
            padding-top: 2px;
        }
        
        .mixed-fraction-container {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            justify-content: center;
        }
        
        .mixed-fraction-whole {
            font-weight: bold;
            align-self: center;
        }
        
        /* API Key ìƒíƒœ í‘œì‹œ ìŠ¤íƒ€ì¼ */
        #apiKeyStatus {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 999;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        #apiKeyStatus.valid {
            background-color: #10b981;
            color: white;
        }
        
        #apiKeyStatus.invalid {
            background-color: #ef4444;
            color: white;
        }
        
        #apiKeyStatus.checking {
            background-color: #f59e0b;
            color: white;
        }
    </style>
</head>
<body>
    <!-- API Key ìƒíƒœ í‘œì‹œ (ìµœìƒë‹¨) -->
    <div id="apiKeyStatus" class="checking">
        ğŸ” API Key í™•ì¸ ì¤‘...
    </div>
    
    <!-- [A] ë©”ì¸ í™”ë©´ (í™ˆ) -->
    <section id="home" class="section active">
        <div class="container mx-auto px-4 py-12">
            <div class="text-center mb-12">
                <h1 class="text-6xl md:text-7xl font-bold text-blue-600 mb-4 drop-shadow-lg">
                    ì¡°ê°ì¡°ê° ë¶„ìˆ˜ë‚˜ë¼
                </h1>
                <p class="text-2xl md:text-3xl text-gray-700 mt-4">
                    ì¬ë¯¸ìˆê²Œ ë°°ìš°ëŠ” ë¶„ìˆ˜ íƒêµ¬
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto mt-16">
                <!-- ë©”ë‰´ ì¹´ë“œ 1: ë¶„ìˆ˜ ì›ë¦¬ íŒŒí—¤ì¹˜ê¸° -->
                <button 
                    onclick="showSection('section1')" 
                    class="menu-card bg-gradient-to-br from-pink-300 to-pink-400 rounded-xl p-8 text-left shadow-lg hover:shadow-xl"
                >
                    <div class="text-5xl mb-4">ğŸ§</div>
                    <h2 class="text-3xl font-bold text-white mb-2">ë¶„ìˆ˜ ì›ë¦¬ íŒŒí—¤ì¹˜ê¸°</h2>
                    <p class="text-lg text-white/90">ë¶„ìˆ˜ê°€ ë¬´ì—‡ì¸ì§€ ì•Œì•„ë´ìš”!</p>
                </button>
                
                <!-- ë©”ë‰´ ì¹´ë“œ 2: ë¶„ìˆ˜ ì§ê¿ ì°¾ê¸° -->
                <button 
                    onclick="showSection('section2')" 
                    class="menu-card bg-gradient-to-br from-purple-300 to-purple-400 rounded-xl p-8 text-left shadow-lg hover:shadow-xl"
                >
                    <div class="text-5xl mb-4">ğŸ§©</div>
                    <h2 class="text-3xl font-bold text-white mb-2">ë¶„ìˆ˜ ì§ê¿ ì°¾ê¸°</h2>
                    <p class="text-lg text-white/90">ê°™ì€ ë¶„ìˆ˜ë¥¼ ì°¾ì•„ë´ìš”!</p>
                </button>
                
                <!-- ë©”ë‰´ ì¹´ë“œ 3: ëŒ€ë¶„ìˆ˜ ë³€ì‹  ë‹¬ë¦¬ê¸° -->
                <button 
                    onclick="showSection('section3')" 
                    class="menu-card bg-gradient-to-br from-green-300 to-green-400 rounded-xl p-8 text-left shadow-lg hover:shadow-xl"
                >
                    <div class="text-5xl mb-4">ğŸƒ</div>
                    <h2 class="text-3xl font-bold text-white mb-2">ëŒ€ë¶„ìˆ˜ ë³€ì‹  ë‹¬ë¦¬ê¸°</h2>
                    <p class="text-lg text-white/90">ëŒ€ë¶„ìˆ˜ë¥¼ ê°€ë¶„ìˆ˜ë¡œ ë°”ê¿”ë´ìš”!</p>
                </button>
                
                <!-- ë©”ë‰´ ì¹´ë“œ 4: ëˆ„ê°€ ëˆ„ê°€ ë” í´ê¹Œ? -->
                <button 
                    onclick="showSection('section4')" 
                    class="menu-card bg-gradient-to-br from-orange-300 to-orange-400 rounded-xl p-8 text-left shadow-lg hover:shadow-xl"
                >
                    <div class="text-5xl mb-4">âš”ï¸</div>
                    <h2 class="text-3xl font-bold text-white mb-2">ëˆ„ê°€ ëˆ„ê°€ ë” í´ê¹Œ?</h2>
                    <p class="text-lg text-white/90">ë¶„ìˆ˜ í¬ê¸°ë¥¼ ë¹„êµí•´ë´ìš”!</p>
                </button>
            </div>
        </div>
    </section>

    <!-- [B] Section 1: ë¶„ìˆ˜ ì›ë¦¬ íŒŒí—¤ì¹˜ê¸° -->
    <section id="section1" class="section">
        <div class="container mx-auto px-4 py-8">
            <!-- í™ˆìœ¼ë¡œ ë²„íŠ¼ -->
            <button 
                onclick="showSection('home')" 
                class="btn-primary mb-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-md"
            >
                ğŸ  í™ˆìœ¼ë¡œ
            </button>
            
            <!-- ì œëª© -->
            <h2 class="text-5xl md:text-6xl font-bold text-center text-blue-600 mb-8">
                ğŸ§ ë¶„ìˆ˜ ì›ë¦¬ íŒŒí—¤ì¹˜ê¸°
            </h2>
            
            <!-- ì½˜í…ì¸  ì˜ì—­ -->
            <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 min-h-[600px]">
                <div id="simulation-area" class="w-full h-full">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- ì¢Œì¸¡: ì¡°ì‘ íŒ¨ë„ -->
                        <div class="space-y-6">
                            <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl p-6 shadow-md">
                                <h3 class="text-2xl font-bold text-gray-800 mb-4">ë¶„ì (Numerator)</h3>
                                <div class="flex items-center justify-center gap-4">
                                    <button 
                                        onclick="changeNumerator(-1)" 
                                        class="bg-red-400 hover:bg-red-500 text-white font-bold w-12 h-12 rounded-full shadow-md text-xl transition-all"
                                    >
                                        -
                                    </button>
                                    <span id="numerator-display" class="text-4xl font-bold text-gray-800 min-w-[60px] text-center">1</span>
                                    <button 
                                        onclick="changeNumerator(1)" 
                                        class="bg-green-400 hover:bg-green-500 text-white font-bold w-12 h-12 rounded-full shadow-md text-xl transition-all"
                                    >
                                        +
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 shadow-md">
                                <h3 class="text-2xl font-bold text-gray-800 mb-4">ë¶„ëª¨ (Denominator)</h3>
                                <div class="flex items-center justify-center gap-4">
                                    <button 
                                        onclick="changeDenominator(-1)" 
                                        class="bg-red-400 hover:bg-red-500 text-white font-bold w-12 h-12 rounded-full shadow-md text-xl transition-all"
                                    >
                                        -
                                    </button>
                                    <span id="denominator-display" class="text-4xl font-bold text-gray-800 min-w-[60px] text-center">4</span>
                                    <button 
                                        onclick="changeDenominator(1)" 
                                        class="bg-green-400 hover:bg-green-500 text-white font-bold w-12 h-12 rounded-full shadow-md text-xl transition-all"
                                    >
                                        +
                                    </button>
                                </div>
                            </div>
                            
                            <!-- í˜„ì¬ ë¶„ìˆ˜ í‘œì‹œ -->
                            <div class="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-xl p-6 shadow-md text-center">
                                <h3 class="text-xl font-bold text-gray-700 mb-3">í˜„ì¬ ë¶„ìˆ˜</h3>
                                <div id="fraction-display" class="text-5xl font-bold text-blue-600 mb-2 flex justify-center items-center">
                                    <!-- ì„¸ë¡œ ë¶„ìˆ˜ í˜•íƒœë¡œ í‘œì‹œë¨ -->
                                </div>
                                <div id="mixed-fraction-display" class="text-2xl text-gray-600 flex justify-center items-center">
                                    <!-- ëŒ€ë¶„ìˆ˜ í‘œì‹œ (ê°€ë¶„ìˆ˜ì¼ ê²½ìš°) -->
                                </div>
                            </div>
                            
                            <!-- AI ìŒ¤ ë²„íŠ¼ -->
                            <button 
                                onclick="askAITutor()" 
                                class="btn-primary w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-4 px-6 rounded-xl shadow-lg text-xl"
                            >
                                ğŸ¤·â€â™‚ï¸ ì˜ ëª¨ë¥´ê² ì–´ìš” (AIì„ ìƒë‹˜)
                            </button>
                        </div>
                        
                        <!-- ìš°ì¸¡: ì‹œê°í™” ì˜ì—­ -->
                        <div class="flex items-center justify-center">
                            <canvas id="fractionCanvas" width="400" height="400" class="max-w-full h-auto"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- AI íŠœí„° ëª¨ë‹¬ -->
            <div id="aiModal" class="modal">
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-3xl font-bold text-purple-600">ğŸ¤– ë¶„ìˆ˜ íƒí—˜ëŒ€ì¥ì˜ ì„¤ëª…</h3>
                        <button 
                            onclick="closeAIModal()" 
                            class="text-gray-500 hover:text-gray-700 text-3xl font-bold"
                        >
                            Ã—
                        </button>
                    </div>
                    <div id="aiResponse" class="text-xl text-gray-700 leading-relaxed">
                        <!-- AI ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    <div class="mt-6 text-center">
                        <button 
                            onclick="closeAIModal()" 
                            class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-xl shadow-md"
                        >
                            ë‹«ê¸°
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- [B] Section 2: ë¶„ìˆ˜ ì§ê¿ ì°¾ê¸° -->
    <section id="section2" class="section">
        <div class="container mx-auto px-4 py-8">
            <!-- í™ˆìœ¼ë¡œ ë²„íŠ¼ -->
            <button 
                onclick="showSection('home')" 
                class="btn-primary mb-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-md"
            >
                ğŸ  í™ˆìœ¼ë¡œ
            </button>
            
            <!-- ì œëª© -->
            <h2 class="text-5xl md:text-6xl font-bold text-center text-purple-600 mb-8">
                ğŸ§© ë¶„ìˆ˜ ì§ê¿ ì°¾ê¸°
            </h2>
            
            <!-- ì½˜í…ì¸  ì˜ì—­ -->
            <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 min-h-[500px]">
                <div id="game1-area" class="w-full h-full">
                    <!-- ì¹´ë“œ ë’¤ì§‘ê¸° ê²Œì„ì´ ë“¤ì–´ê°ˆ ì˜ì—­ -->
                    <p class="text-center text-gray-500 text-xl mt-20">
                        ì¹´ë“œ ë’¤ì§‘ê¸° ê²Œì„ ì˜ì—­ (ê²Œì„ì´ ë“¤ì–´ê°ˆ ì˜ˆì •)
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- [B] Section 3: ëŒ€ë¶„ìˆ˜ ë³€ì‹  ë‹¬ë¦¬ê¸° -->
    <section id="section3" class="section">
        <div class="container mx-auto px-4 py-8">
            <!-- í™ˆìœ¼ë¡œ ë²„íŠ¼ -->
            <button 
                onclick="showSection('home')" 
                class="btn-primary mb-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-md"
            >
                ğŸ  í™ˆìœ¼ë¡œ
            </button>
            
            <!-- ì œëª© -->
            <h2 class="text-5xl md:text-6xl font-bold text-center text-green-600 mb-8">
                ğŸƒ ëŒ€ë¶„ìˆ˜ ë³€ì‹  ë‹¬ë¦¬ê¸°
            </h2>
            
            <!-- ì½˜í…ì¸  ì˜ì—­ -->
            <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 min-h-[500px]">
                <div id="game2-area" class="w-full h-full">
                    <!-- íš¡ìŠ¤í¬ë¡¤ ëŸ¬ë‹ ê²Œì„ì´ ë“¤ì–´ê°ˆ ì˜ì—­ -->
                    <p class="text-center text-gray-500 text-xl mt-20">
                        íš¡ìŠ¤í¬ë¡¤ ëŸ¬ë‹ ê²Œì„ ì˜ì—­ (ê²Œì„ì´ ë“¤ì–´ê°ˆ ì˜ˆì •)
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- [B] Section 4: ëˆ„ê°€ ëˆ„ê°€ ë” í´ê¹Œ? -->
    <section id="section4" class="section">
        <div class="container mx-auto px-4 py-8">
            <!-- í™ˆìœ¼ë¡œ ë²„íŠ¼ -->
            <button 
                onclick="showSection('home')" 
                class="btn-primary mb-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-md"
            >
                ğŸ  í™ˆìœ¼ë¡œ
            </button>
            
            <!-- ì œëª© -->
            <h2 class="text-5xl md:text-6xl font-bold text-center text-orange-600 mb-8">
                âš”ï¸ ëˆ„ê°€ ëˆ„ê°€ ë” í´ê¹Œ?
            </h2>
            
            <!-- ì½˜í…ì¸  ì˜ì—­ -->
            <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 min-h-[500px]">
                <div id="game3-area" class="w-full h-full">
                    <!-- ë¶€ë“±í˜¸ í€´ì¦ˆ ê²Œì„ì´ ë“¤ì–´ê°ˆ ì˜ì—­ -->
                    <p class="text-center text-gray-500 text-xl mt-20">
                        ë¶€ë“±í˜¸ í€´ì¦ˆ ê²Œì„ ì˜ì—­ (ê²Œì„ì´ ë“¤ì–´ê°ˆ ì˜ˆì •)
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- JavaScript -->
    <script type="module">
        // ========== ì „ì—­ ë³€ìˆ˜ ==========
        let numerator = 1;  // ë¶„ì
        let denominator = 4;  // ë¶„ëª¨
        let API_KEY_FINAL = null;  // API Key (ë‚˜ì¤‘ì— ì„¤ì •ë¨)
        
        // í™˜ê²½ë³€ìˆ˜ ê°€ì ¸ì˜¤ê¸° (config.jsì—ì„œ import)
        import { API_KEY } from './src/config.js';
        
        // ì¦‰ì‹œ API_KEY ì„¤ì • ì‹œë„
        API_KEY_FINAL = API_KEY;
        
        // ë””ë²„ê¹…: í™˜ê²½ë³€ìˆ˜ í™•ì¸
        console.log('=== index.html ìŠ¤í¬ë¦½íŠ¸ì—ì„œ í™˜ê²½ë³€ìˆ˜ í™•ì¸ ===');
        console.log('import.meta.env:', import.meta.env);
        console.log('import.meta.env.VITE_OPENAI_API_KEY:', import.meta.env.VITE_OPENAI_API_KEY);
        console.log('import.meta.env.MODE:', import.meta.env.MODE);
        console.log('import.meta.env.DEV:', import.meta.env.DEV);
        console.log('config.jsì—ì„œ ê°€ì ¸ì˜¨ API_KEY:', API_KEY);
        console.log('API_KEY íƒ€ì…:', typeof API_KEY);
        console.log('API_KEY ê°’:', API_KEY ? `"${API_KEY.substring(0, 10)}..." (ê¸¸ì´: ${API_KEY.length})` : 'undefined ë˜ëŠ” null');
        console.log('window.VITE_OPENAI_API_KEY:', window.VITE_OPENAI_API_KEY);
        
        // API_KEY ì„¤ì • (ì—¬ëŸ¬ ì†ŒìŠ¤ì—ì„œ ì‹œë„)
        if (!API_KEY_FINAL) {
            API_KEY_FINAL = window.VITE_OPENAI_API_KEY || import.meta.env.VITE_OPENAI_API_KEY;
        }
        console.log('ìµœì¢… API_KEY_FINAL:', API_KEY_FINAL ? `"${API_KEY_FINAL.substring(0, 10)}..." (ê¸¸ì´: ${API_KEY_FINAL.length})` : 'undefined ë˜ëŠ” ë¹ˆ ê°’');
        console.log('==========================================');
        
        // config.jsê°€ ë¡œë“œë  ë•Œê¹Œì§€ ì ì‹œ ëŒ€ê¸° í›„ API Key ê²€ì¦
        setTimeout(() => {
            // window ê°ì²´ì— ë‹¤ì‹œ í™•ì¸
            if (!API_KEY_FINAL) {
                API_KEY_FINAL = window.VITE_OPENAI_API_KEY || import.meta.env.VITE_OPENAI_API_KEY;
                console.log('setTimeout í›„ ì¬í™•ì¸ - API_KEY_FINAL:', API_KEY_FINAL ? `"${API_KEY_FINAL.substring(0, 10)}..."` : 'ì—†ìŒ');
            }
            checkAPIKey();
        }, 200);
        
        // ========== API Key ê²€ì¦ í•¨ìˆ˜ ==========
        async function checkAPIKey() {
            const statusDiv = document.getElementById('apiKeyStatus');
            
            // API_KEY_FINAL ì¬í™•ì¸ (ë™ì  ì—…ë°ì´íŠ¸)
            let currentAPIKey = API_KEY_FINAL || window.VITE_OPENAI_API_KEY || import.meta.env.VITE_OPENAI_API_KEY;
            
            console.log('checkAPIKey í˜¸ì¶œë¨ - currentAPIKey:', currentAPIKey ? 'ìˆìŒ (ê¸¸ì´: ' + currentAPIKey.length + ')' : 'ì—†ìŒ');
            
            if (!currentAPIKey || currentAPIKey === 'your_api_key_here' || String(currentAPIKey).trim() === '' || currentAPIKey === 'undefined') {
                statusDiv.className = 'invalid';
                statusDiv.textContent = 'âŒ API Key ë¯¸ì„¤ì •';
                statusDiv.title = '.env íŒŒì¼ì— VITE_OPENAI_API_KEY=sk-your-keyë¥¼ ì„¤ì •í•˜ê³  Vite ì„œë²„ë¥¼ ì¬ì‹œì‘í•˜ì„¸ìš”.';
                console.error('API Keyë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. .env íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.');
                return false;
            }
            
            // API Key í˜•ì‹ í™•ì¸ (sk-ë¡œ ì‹œì‘í•˜ëŠ”ì§€)
            if (!currentAPIKey.startsWith('sk-')) {
                statusDiv.className = 'invalid';
                statusDiv.textContent = 'âš ï¸ API Key í˜•ì‹ ì˜¤ë¥˜';
                statusDiv.title = 'API KeyëŠ” sk-ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤.';
                return false;
            }
            
            // ì‹¤ì œ API í˜¸ì¶œë¡œ ê²€ì¦
            statusDiv.className = 'checking';
            statusDiv.textContent = 'ğŸ” API Key ê²€ì¦ ì¤‘...';
            
            try {
                const response = await fetch('https://api.openai.com/v1/models', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${currentAPIKey}`
                    }
                });
                
                if (response.ok) {
                    statusDiv.className = 'valid';
                    statusDiv.textContent = 'âœ… API Key ì •ìƒ';
                    statusDiv.title = 'OpenAI APIê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.';
                    return true;
                } else if (response.status === 401) {
                    statusDiv.className = 'invalid';
                    statusDiv.textContent = 'âŒ API Key ì¸ì¦ ì‹¤íŒ¨';
                    statusDiv.title = 'API Keyê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                    return false;
                } else {
                    statusDiv.className = 'invalid';
                    statusDiv.textContent = 'âš ï¸ API ì—°ê²° ì˜¤ë¥˜';
                    statusDiv.title = `API ì—°ê²° ì˜¤ë¥˜: ${response.status}`;
                    return false;
                }
            } catch (error) {
                statusDiv.className = 'invalid';
                statusDiv.textContent = 'âš ï¸ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜';
                statusDiv.title = `ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`;
                return false;
            }
        }
        
        // ========== ì„¹ì…˜ ì „í™˜ í•¨ìˆ˜ ==========
        function showSection(sectionId) {
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            const allSections = document.querySelectorAll('.section');
            allSections.forEach(section => {
                section.classList.remove('active');
            });
            
            // ì„ íƒí•œ ì„¹ì…˜ ë³´ì´ê¸°
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                // Section 1ë¡œ ì´ë™ ì‹œ Canvas ë‹¤ì‹œ ê·¸ë¦¬ê¸°
                if (sectionId === 'section1') {
                    setTimeout(() => {
                        drawFraction();
                    }, 100);
                }
            }
        }
        
        // ========== ë¶„ì ì¡°ì ˆ í•¨ìˆ˜ ==========
        function changeNumerator(delta) {
            numerator += delta;
            if (numerator < 0) numerator = 0;
            updateDisplay();
            drawFraction();
        }
        
        // ========== ë¶„ëª¨ ì¡°ì ˆ í•¨ìˆ˜ ==========
        function changeDenominator(delta) {
            denominator += delta;
            if (denominator < 1) denominator = 1;
            if (denominator > 10) denominator = 10;
            updateDisplay();
            drawFraction();
        }
        
        // ========== ì„¸ë¡œ ë¶„ìˆ˜ ë Œë”ë§ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ==========
        /**
         * ë¶„ìˆ˜ë¥¼ ì„¸ë¡œ í˜•íƒœ(êµê³¼ì„œ ìŠ¤íƒ€ì¼)ë¡œ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
         * @param {number} num - ë¶„ì
         * @param {number} den - ë¶„ëª¨
         * @param {string} sizeClass - Tailwind CSS í¬ê¸° í´ë˜ìŠ¤ (ì˜ˆ: 'text-5xl', 'text-3xl')
         * @returns {string} HTML ë¬¸ìì—´
         */
        function renderFraction(num, den, sizeClass = 'text-5xl') {
            return `
                <div class="fraction-vertical ${sizeClass}">
                    <span class="fraction-numerator">${num}</span>
                    <div class="fraction-line"></div>
                    <span class="fraction-denominator">${den}</span>
                </div>
            `;
        }
        
        /**
         * ëŒ€ë¶„ìˆ˜ë¥¼ ì„¸ë¡œ í˜•íƒœë¡œ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
         * @param {number} whole - ìì—°ìˆ˜ ë¶€ë¶„
         * @param {number} num - ë¶„ì
         * @param {number} den - ë¶„ëª¨
         * @param {string} sizeClass - Tailwind CSS í¬ê¸° í´ë˜ìŠ¤
         * @returns {string} HTML ë¬¸ìì—´
         */
        function renderMixedFraction(whole, num, den, sizeClass = 'text-2xl') {
            return `
                <div class="mixed-fraction-container ${sizeClass}">
                    <span class="mixed-fraction-whole">${whole}</span>
                    ${renderFraction(num, den, sizeClass)}
                </div>
            `;
        }
        
        // ========== í™”ë©´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ==========
        function updateDisplay() {
            document.getElementById('numerator-display').textContent = numerator;
            document.getElementById('denominator-display').textContent = denominator;
            
            // ì„¸ë¡œ ë¶„ìˆ˜ í˜•íƒœë¡œ í‘œì‹œ
            const fractionDisplay = document.getElementById('fraction-display');
            fractionDisplay.innerHTML = renderFraction(numerator, denominator, 'text-5xl');
            
            // ëŒ€ë¶„ìˆ˜ í‘œì‹œ (ê°€ë¶„ìˆ˜ì¼ ê²½ìš°)
            const mixedFractionDisplay = document.getElementById('mixed-fraction-display');
            if (numerator >= denominator && denominator > 0) {
                const whole = Math.floor(numerator / denominator);
                const remainder = numerator % denominator;
                if (remainder === 0) {
                    // ì •ìˆ˜ì¸ ê²½ìš°
                    mixedFractionDisplay.innerHTML = `<span class="text-2xl font-bold text-gray-600">${whole}</span>`;
                } else {
                    // ëŒ€ë¶„ìˆ˜ì¸ ê²½ìš°
                    mixedFractionDisplay.innerHTML = renderMixedFraction(whole, remainder, denominator, 'text-2xl');
                }
            } else {
                mixedFractionDisplay.innerHTML = '';
            }
        }
        
        // ========== Canvasì— ë¶„ìˆ˜ ê·¸ë¦¬ê¸° í•¨ìˆ˜ ==========
        function drawFraction() {
            const canvas = document.getElementById('fractionCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            
            if (denominator === 0) return;
            
            const radius = 80;  // ì›ì˜ ë°˜ì§€ë¦„
            const centerX = width / 2;
            const centerY = height / 2;
            
            // ê°€ë¶„ìˆ˜ ì²˜ë¦¬: ë¶„ìê°€ ë¶„ëª¨ë³´ë‹¤ í¬ë©´ ì—¬ëŸ¬ ê°œì˜ ì› ê·¸ë¦¬ê¸°
            const fullCircles = Math.floor(numerator / denominator);
            const remainder = numerator % denominator;
            const totalCircles = fullCircles + (remainder > 0 ? 1 : 0);
            
            // ì›ë“¤ì´ ìº”ë²„ìŠ¤ ì•ˆì— ë“¤ì–´ê°€ë„ë¡ ìœ„ì¹˜ ì¡°ì •
            const circleSpacing = 180;
            const startX = centerX - ((totalCircles - 1) * circleSpacing) / 2;
            
            for (let circleIndex = 0; circleIndex < totalCircles; circleIndex++) {
                const x = startX + circleIndex * circleSpacing;
                const y = centerY;
                
                // í˜„ì¬ ì›ì— ê·¸ë ¤ì•¼ í•  ì¡°ê° ìˆ˜ ê²°ì •
                let slicesToFill;
                if (circleIndex < fullCircles) {
                    slicesToFill = denominator;  // ì™„ì „íˆ ì±„ì›Œì§„ ì›
                } else {
                    slicesToFill = remainder;  // ë‚˜ë¨¸ì§€ ì¡°ê°
                }
                
                // ì› ê·¸ë¦¬ê¸°
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, 2 * Math.PI);
                ctx.strokeStyle = '#333333';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // ë¶€ì±„ê¼´ë¡œ ë“±ë¶„í•˜ì—¬ ê·¸ë¦¬ê¸°
                const anglePerSlice = (2 * Math.PI) / denominator;
                
                for (let i = 0; i < denominator; i++) {
                    const startAngle = i * anglePerSlice - Math.PI / 2;  // ìœ„ìª½ë¶€í„° ì‹œì‘
                    const endAngle = (i + 1) * anglePerSlice - Math.PI / 2;
                    
                    // ì¡°ê° ê·¸ë¦¬ê¸°
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.arc(x, y, radius, startAngle, endAngle);
                    ctx.closePath();
                    
                    // ìƒ‰ì¹  ì—¬ë¶€ ê²°ì •
                    if (i < slicesToFill) {
                        // ìƒ‰ì¹ ëœ ì¡°ê° (ë°ì€ ì£¼í™©ìƒ‰ ë˜ëŠ” íŒŒë€ìƒ‰)
                        ctx.fillStyle = i % 2 === 0 ? '#FFB84D' : '#4A90E2';
                    } else {
                        // ìƒ‰ì¹ ë˜ì§€ ì•Šì€ ì¡°ê° (ì—°í•œ íšŒìƒ‰)
                        ctx.fillStyle = '#F0F0F0';
                    }
                    ctx.fill();
                    
                    // ê²½ê³„ì„  ê·¸ë¦¬ê¸°
                    ctx.strokeStyle = '#333333';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }
        }
        
        // ========== AI íŠœí„° í•¨ìˆ˜ ==========
        async function askAITutor() {
            const modal = document.getElementById('aiModal');
            const responseDiv = document.getElementById('aiResponse');
            
            // ëª¨ë‹¬ ì—´ê¸°
            modal.classList.add('active');
            responseDiv.textContent = 'ğŸ¤” ë¶„ìˆ˜ íƒí—˜ëŒ€ì¥ì´ ìƒê° ì¤‘ì´ì—ìš”...';
            
            // API Key í™•ì¸ (ì—¬ëŸ¬ ì†ŒìŠ¤ì—ì„œ ì‹œë„)
            const currentAPIKey = API_KEY_FINAL || window.VITE_OPENAI_API_KEY || import.meta.env.VITE_OPENAI_API_KEY;
            if (!currentAPIKey || currentAPIKey === 'your_api_key_here' || String(currentAPIKey).trim() === '') {
                responseDiv.innerHTML = `
                    <div class="text-red-500 mb-4">
                        âš ï¸ API Keyë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”!<br>
                        <code class="bg-gray-100 px-2 py-1 rounded">.env</code> íŒŒì¼ì— <code class="bg-gray-100 px-2 py-1 rounded">VITE_OPENAI_API_KEY=your_api_key</code>ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.
                    </div>
                    <div class="text-gray-600">
                        <strong>ì˜ˆì‹œ ì„¤ëª…:</strong><br>
                        í˜„ì¬ ë¶„ìˆ˜ëŠ” ${numerator}/${denominator}ì´ì—ìš”! ğŸ•<br>
                        ${denominator}ì¡°ê°ìœ¼ë¡œ ë‚˜ëˆˆ í”¼ìì—ì„œ ${numerator}ì¡°ê°ì„ ë¨¹ì—ˆë‹¤ëŠ” ëœ»ì´ì—ìš”!<br>
                        ${numerator >= denominator ? `ì™€! í”¼ì í•œ íŒì„ ë‹¤ ë¨¹ê³  ${numerator - denominator}ì¡°ê°ì„ ë” ë¨¹ì—ˆë„¤ìš”!` : 'ì•„ì§ ì¡°ê¸ˆ ë‚¨ì•˜ì–´ìš”!'}
                    </div>
                `;
                return;
            }
            
            try {
                const systemPrompt = `ë„ˆëŠ” ì´ˆë“±í•™ìƒ ìˆ˜í•™ íŠœí„° 'ë¶„ìˆ˜ íƒí—˜ëŒ€ì¥'ì´ì•¼.
ë§íˆ¬: ì¹œì ˆ, ìœ ì¾Œ, ì´ëª¨ì§€ ì‚¬ìš©.
ì„¤ëª…ë²•: 'í”¼ì'ì— ë¹„ìœ í•´ì„œ ì„¤ëª…. (ë¶„ëª¨=í”¼ì ì¡°ê° ìˆ˜, ë¶„ì=ë¨¹ì€ ìˆ˜).
ê°€ë¶„ìˆ˜ ì„¤ëª…: 5/4ë¼ë©´ 'í”¼ì í•œ íŒ ë‹¤ ë¨¹ê³  í•œ ì¡°ê° ë”!' ì‹ìœ¼ë¡œ ì‹œê°ì  ì„¤ëª….
ê¸¸ì´: 3ë¬¸ì¥ ì´ë‚´.`;
                
                const userPrompt = `í˜„ì¬ ë¶„ëª¨ëŠ” ${denominator}, ë¶„ìëŠ” ${numerator}ì´ì•¼. ê·¸ë¦¼ìœ¼ë¡œ ì›ì´ ê·¸ë ¤ì ¸ ìˆì–´. ì´ê²Œ ë¬´ìŠ¨ ëœ»ì¸ì§€ ì‰½ê²Œ ì„¤ëª…í•´ì¤˜.`;
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentAPIKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: userPrompt }
                        ],
                        max_tokens: 200,
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error('API ìš”ì²­ ì‹¤íŒ¨');
                }
                
                const data = await response.json();
                const aiMessage = data.choices[0].message.content;
                responseDiv.textContent = aiMessage;
                
            } catch (error) {
                console.error('AI íŠœí„° ì˜¤ë¥˜:', error);
                responseDiv.innerHTML = `
                    <div class="text-red-500">
                        ğŸ˜¢ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”: ${error.message}<br>
                        API Keyë¥¼ í™•ì¸í•˜ê±°ë‚˜ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
                    </div>
                `;
            }
        }
        
        // ========== AI ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜ ==========
        function closeAIModal() {
            const modal = document.getElementById('aiModal');
            modal.classList.remove('active');
        }
        
        // ========== ì „ì—­ í•¨ìˆ˜ë¡œ ë‚´ë³´ë‚´ê¸° (onclick ì†ì„± ì‚¬ìš©ì„ ìœ„í•´) ==========
        window.showSection = showSection;
        window.changeNumerator = changeNumerator;
        window.changeDenominator = changeDenominator;
        window.askAITutor = askAITutor;
        window.closeAIModal = closeAIModal;
        window.renderFraction = renderFraction;
        window.renderMixedFraction = renderMixedFraction;
        
        // ========== ì´ˆê¸°í™” ==========
        document.addEventListener('DOMContentLoaded', async function() {
            showSection('home');
            updateDisplay();
            drawFraction();
            
            // API Key ê²€ì¦
            await checkAPIKey();
        });
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('aiModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeAIModal();
            }
        });
    </script>
</body>
</html>
